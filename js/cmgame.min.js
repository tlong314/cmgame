"use strict";Math.TAU=Math.TAU||2*Math.PI,Math.SQRT3=Math.SQRT3||Math.sqrt(3),Math.SQRT5=Math.SQRT5||Math.sqrt(5),Math.PHI=Math.PHI||.5*(1+Math.SQRT5),Math.csc=t=>1/Math.sin(t),Math.sec=t=>1/Math.cos(t),Math.cot=t=>1/Math.tan(t),window.requestNextFrame=window.requestAnimationFrame.bind(window),window.cancelNextFrame=window.cancelAnimationFrame.bind(window),window.documentBody=null,document.body?window.documentBody=document.body:(window.documentBody=document.body=document.documentElement.appendChild(document.createElement("body")),console.warn("Some issues may arise without certain HTML tags present. If you need touch/mouse events, provide either a <body> tag or a <canvas> tag in your HTML.")),null!==document.currentScript?window.CM_SILENCE_PATH=document.currentScript.src.replace(/js\/cmgame(\/min)?\.js$/,"audio/silencesecond.wav"):window.CM_SILENCE_PATH="js/cmgame/audio/silencesecond.wav";const CMSound=function(){let t=new Audio;t.src=window.CM_SILENCE_PATH;let e=!1,i=!1,s={},n=new Map,h=window.AudioContext||window.webkitAudioContext,a=null,o=!1,r=[];async function l(t,i=null){if(!e)return r.push({filepath:t,preferredName:i}),Promise.resolve(null);if(n.has(t))return n.get(t);let s=await fetch(t),h=await s.arrayBuffer(),o;try{o=await a.decodeAudioData(h)}catch(l){var c;o=await (c=h,new Promise((t,e)=>{a.decodeAudioData(c,e=>t(e),t=>e(t))}))}return n.set(i||t,o),o}function c(t,e){return n.has(t)?(s[t]=a.createBufferSource(),s[t].loop=!!e,s[t].buffer=n.get(t),s[t].connect(a.destination),s[t].start(),Promise.resolve(s[t])):l(t).then(i=>null===i?Promise.reject("CMSound audios not loaded"):(s[t]=a.createBufferSource(),s[t].loop=!!e,s[t].buffer=i,s[t].connect(a.destination),s[t].start(),s[t]))}return!function s(){if(o)return;let n=function(s){a=new h;let c=a.createBuffer(1,1,22050);t.onended=function(){var t=a.createBufferSource();t.buffer=c,t.connect(a.destination),t.start(0),"function"==typeof a.resume&&a.resume(),t.onended=function(){t.disconnect(0),o=!0,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("click",n,!0),i||(i=!0,Promise.all(r.map(t=>l(t.filepath,t.preferredName,"from prom"))).then(()=>{}))}},e||(e=!0,t.play())};document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0)}(),{play:c,pause:function(t){void 0!==s[t]&&s[t].stop()},stop:function(t){void 0!==s[t]&&s[t].stop(0)},load:l,loop:function(t){return c(t,!0)}}}();class CMRandom{constructor(){let t=function*(){for(;;)yield CMRandom.range(-2147483648+1,2147483648)}();this.nextInt=function(e){if(void 0===e)return t.next().value;if(e<0)throw Error("CMRandom.nextInt must take nonnegative bound (or no bound)");return CMRandom.range(0,e)};let e=function*(){for(;;)yield!!CMRandom.range(0,2)}();this.nextBoolean=function(){return e.next().value}}}CMRandom.range=(t,e)=>Number.isInteger(t)&&Number.isInteger(e)?t+Math.random()*(e-t)>>0:t+Math.random()*(e-t),CMRandom.nonzero=(t,e)=>{if(t>0||e<0)return CMRandom.range(t,e);let i=0,s=0;return s=Number.isInteger(t)&&Number.isInteger(e)?1:Number.MIN_VALUE,(i=Number.isInteger(t)&&Number.isInteger(e-s)?t+Math.random()*(e-t):CMRandom.range(t,e-s))>=0&&(i+=s),i},Object.defineProperties(CMRandom,{radian:{get:function(){let t=CMRandom.range(0,Math.TAU);return t>=Math.TAU&&(t=0),t}},degree:{get:function(){return CMRandom.range(0,360)}},value:{get:function(){return parseFloat(Math.random().toFixed(7))}},color:{get:function(){let t=Object.keys(CMColor).filter(t=>-1===t.indexOf("TRANS")&&-1===t.indexOf("NONE")&&-1===t.indexOf("CLEAR"));return CMColor[t[CMRandom.range(0,t.length)]]}},colorscale:{get:function(){let t=Object.keys(CMColor).filter(t=>!t.match(/GRAY|BLACK|WHITE|SAND|TRANS|NONE|CLEAR/));return CMColor[t[CMRandom.range(0,t.length)]]}},grayscale:{get:function(){let t=Object.keys(CMColor).filter(t=>!!t.match(/GRAY|BLACK|WHITE/));return CMColor[t[CMRandom.range(0,t.length)]]}},sign:{get:function(){return(-1)**CMRandom.range(0,2)}}}),Object.defineProperty(CMRandom,"boolean",{get:function(){return!!(2*Math.random()>>0)}});class CMPoint{constructor(t=0,e=0,i=0){if(this.x=t,this.y=e,this.z=i,"object"==typeof t){let s=t;this.x=s.x||0,this.y=s.y||0,this.z=s.z||0}}isPoint(t){return!!t&&this.x===t.x&&this.y===t.y&&(this.z===t.z||0===this.z&&void 0===t.z)}isAlmost(t){let e=void 0===t.z?0:t.z;return!CMGame.roundSmall(this.x-t.x)&&!CMGame.roundSmall(this.y-t.y)&&!CMGame.roundSmall(this.z-e)}}let domLoaded=!1,numAudiosToLoad=0,numAudiosLoaded=0,numImagesToLoad=0,numImagesLoaded=0;class CMImage extends Image{constructor(t){if(super(),t instanceof CMImage)return this;numImagesToLoad++;let e=document.getElementById("cmLoadingProgress");null!==e&&e.setAttribute("max",numImagesToLoad+numAudiosToLoad+1),this.onload=registerImageLoad,this.src=t}}class CMAudio extends Audio{constructor(t,e,i){if(super(),t instanceof CMAudio)return this;numAudiosToLoad++;let s=document.getElementById("cmLoadingProgress");null!==s&&s.setAttribute("max",numImagesToLoad+numAudiosToLoad+1),this.oncanplaythrough=registerAudioLoad,this.src=t,this.load();let n=CMGame.trimFilename(t);"string"==typeof e?(i.audioMap.set(e,this),CMSound.load(t,e)):(i.audioMap.set(n,this),CMSound.load(t))}}const incrementLoadingProgress=()=>{let t=document.getElementById("cmLoadingProgress");null!==t&&(t.value=parseInt(t.value)+1)},initializeIfReady=()=>{if(incrementLoadingProgress(),numImagesLoaded===numImagesToLoad&&numAudiosLoaded===numAudiosToLoad&&domLoaded){CMGame.resourcesLoaded=!0,CMGame.onresourcesload();let t=document.getElementById("cmLoading");null!==t&&(t.addEventListener("animationend",e=>{t.classList.remove("cm-intro-fade"),t.style.display="none"},!1),t.classList.add("cm-intro-fade"))}},registerImageLoad=()=>{this.loaded=!0,numImagesLoaded++,initializeIfReady()},registerAudioLoad=()=>{this.loaded=!0,numAudiosLoaded++,initializeIfReady()};class CMDoodle{constructor(t,e){this.game=t;let i={},s={startPoint:null,lineWidth:Math.max(t.ctx.lineWidth,1),strokeStyle:CMColor.BLACK,fillStyle:CMColor.NONE,fillStyleAbove:CMColor.NONE,fillStyleBelow:CMColor.NONE,fillStyleLeft:CMColor.NONE,fillStyleRight:CMColor.NONE};for(let n in s)void 0!==e[n]?i[n]=e[n]:i[n]=s[n];this.startPoint=i.startPoint,this.lineWidth=i.lineWidth,this.strokeStyle=i.strokeStyle,this.fillStyleAbove=i.fillStyleAbove,this.fillStyleBelow=i.fillStyleBelow,this.fillStyleLeft=i.fillStyleLeft,this.fillStyleRight=i.fillStyleRight,this.fillStyle=i.fillStyle,this.points=[this.startPoint],this.path=new Path2D,this.path.moveTo(this.startPoint.x,this.startPoint.y),this.pathAbove=new Path2D,this.pathBelow=new Path2D,this.pathLeft=new Path2D,this.pathRight=new Path2D}clear(){this.path=new Path2D,CMGame.clearAll(this.points),this.game.doodles.splice(this.game.doodles.indexOf(this),1)}addPoint(t,e){let i={};i="number"==typeof t?{x:t,y:e}:t,this.points[this.points.length-1].isPoint(i)||(this.points.push(new CMPoint(i)),this.path.lineTo(i.x,i.y),this.rebuildPath(),this.rebuildFilledPaths())}removePoint(t,e){let i={};i="number"==typeof t?{x:t,y:e}:t,this.points.splice(this.points.findIndex(t=>t.x===i.x&&t.y===i.y),1),this.rebuildPath(),this.rebuildFilledPaths()}intersectsPoint(t,e){let i={};i="number"==typeof t?{x:t,y:e}:t,this.game.ctx.save(),this.game.ctx.lineWidth=this.lineWidth;let s=game.ctx.isPointInStroke(this.path,i.x,i.y);return this.game.ctx.restore(),s}containsPoint(t,e){let i={};i="number"==typeof t?{x:t,y:e}:t,this.game.ctx.save(),this.game.ctx.lineWidth=this.lineWidth;let s=game.ctx.isPointInPath(this.path,i.x,i.y);return this.game.ctx.restore(),s}rebuildPath(){this.path=new Path2D,this.path.moveTo(this.startPoint.x,this.startPoint.y);for(let t=1;t<this.points.length;t++)this.path.lineTo(this.points[t].x,this.points[t].y)}rebuildFilledPaths(){let t=this.game.canvas,e=this.game.ctx,i=this.points[0],s=this.points[this.points.length-1],n=[i,s].sort((t,e)=>t.x-e.x)[0],h=[i,s].sort((t,e)=>e.x-t.x)[0],a=[i,s].sort((t,e)=>t.y-e.y)[0],o=[i,s].sort((t,e)=>e.y-t.y)[0];this.fillStyleBelow&&this.fillStyleBelow!==CMColor.NONE&&(this.pathBelow=new Path2D(this.path),i.x<=s.x?(this.pathBelow.lineTo(h.x,t.height+e.lineWidth),this.pathBelow.lineTo(n.x,t.height+e.lineWidth),this.pathBelow.closePath()):(this.pathBelow.lineTo(n.x,t.height+e.lineWidth),this.pathBelow.lineTo(h.x,t.height+e.lineWidth),this.pathBelow.closePath()),this.pathBelow.closePath()),this.fillStyleAbove&&this.fillStyleAbove!==CMColor.NONE&&(this.pathAbove=new Path2D(this.path),i.x<=s.x?(this.pathAbove.lineTo(h.x,0-e.lineWidth),this.pathAbove.lineTo(n.x,0-e.lineWidth)):(this.pathAbove.lineTo(n.x,0-e.lineWidth),this.pathAbove.lineTo(h.x,0-e.lineWidth)),this.pathAbove.closePath()),this.fillStyleLeft&&this.fillStyleLeft!==CMColor.NONE&&(this.pathLeft=new Path2D(this.path),i.y<=s.y?(this.pathLeft.lineTo(-e.lineWidth,o.y),this.pathLeft.lineTo(-e.lineWidth,a.y)):(this.pathLeft.lineTo(-e.lineWidth,a.y),this.pathLeft.lineTo(-e.lineWidth,o.y)),this.pathLeft.closePath()),this.fillStyleRight&&this.fillStyleRight!==CMColor.NONE&&(this.pathRight=new Path2D(this.path),i.y<=s.y?(this.pathRight.lineTo(t.width+e.lineWidth,o.y),this.pathRight.lineTo(t.width+e.lineWidth,a.y)):(this.pathRight.lineTo(t.width+e.lineWidth,a.y),this.pathRight.lineTo(t.width+e.lineWidth,o.y)),this.pathRight.closePath())}draw(t=this.game.offscreenCtx){t.save(),this.pathLeft&&(t.fillStyle=this.fillStyleLeft,t.fill(this.pathLeft)),this.pathRight&&(t.fillStyle=this.fillStyleRight,t.fill(this.pathRight)),this.pathAbove&&(t.fillStyle=this.fillStyleAbove,t.fill(this.pathAbove)),this.pathBelow&&(t.fillStyle=this.fillStyleBelow,t.fill(this.pathBelow)),this.points.length>1?(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,this.fillStyle&&this.fillStyle!==CMColor.NONE&&(t.fillStyle=this.fillStyle,t.fill(this.path)),t.stroke(this.path)):1===this.points.length&&(t.fillStyle=this.strokeStyle,t.fillRect(this.points[0].x,this.points[0].y,Math.max(.5*this.lineWidth,1),Math.max(.5*this.lineWidth,1))),t.restore()}}class CMSwipe{constructor(t,e,i,s,n){this.game=t,this.x=e,this.y=i,this.oldX=s,this.oldY=n,this.offsetX=this.x-this.oldX,this.offsetY=this.y-this.oldY,this.angle=this.game.toPolar(new CMPoint(e-s,i-n)).theta,this.direction=this.getDirection(s,n,e,i),this.direction8=this.getDirection8(s,n,e,i),t.latestSwipes.push(this),t.latestSwipeStrings.push(this.direction),t.latestSwipeStrings8.push(this.direction8),t.latestSwipePath.length&&this.direction===CMGame.last(t.latestSwipePath)||t.latestSwipePath.push(this.direction),t.latestSwipePath8.length&&this.direction8===CMGame.last(t.latestSwipePath8)||t.latestSwipePath8.push(this.direction8)}getDirection(t,e,i,s){let n=this.angle;return n>=1.75*Math.PI||n<.25*Math.PI?this.direction="right":n>=.25*Math.PI&&n<.75*Math.PI?this.direction="down":n>=.75*Math.PI&&n<1.25*Math.PI?this.direction="left":n>=1.25*Math.PI&&n<1.75*Math.PI&&(this.direction="up"),this.direction}getDirection8(t,e,i,s){let n=this.angle,h=Math.PI/8;return n>=15*h||n<1*h?this.direction8="right":n>=1*h&&n<3*h?this.direction8="downright":n>=3*h&&n<5*h?this.direction8="down":n>=5*h&&n<7*h?this.direction8="downleft":n>=7*h&&n<9*h?this.direction8="left":n>=9*h&&n<11*h?this.direction8="upleft":n>=11*h&&n<13*h?this.direction8="up":n>=13*h&&n<15*h&&(this.direction8="upright"),this.direction8}}let previousFrameTime=performance.now();class CMGame{constructor(t={}){let e=this;if(this.debug=!!t.debug,this.debug&&"object"==typeof t.debugOptions)for(let i of Object.keys(t.debugOptions))"debugOptions"!==i&&(t[i]=t.debugOptions[i]);if(this.images={},this.audios={},this.audioSources={},this.audioMap=new Map,Array.isArray(t.images))for(let s=0;s<t.images.length;s++){let n=CMGame.trimFilename(t.images[s]);this.images[s]=this.images[n]=new CMImage(t.images[s])}else for(let h in t.images)this.images[h]=new CMImage(t.images[h]);if(Array.isArray(t.audios))for(let a=0;a<t.audios.length;a++){let o=CMGame.trimFilename(t.audios[a]);this.audios[a]=this.audios[o]=new CMAudio(t.audios[a],null,this),this.audioSources[o]=t.audios[a]}else for(let r in t.audios)this.audios[r]=new CMAudio(t.audios[r],r,this),this.audioSources[r]=t.audios[r];if(void 0===t.overrideStyles&&![...document.styleSheets].find(t=>t?.href?.match("cmgame.css"))){let l=document.createElement("link");l.rel="stylesheet",l.type="text/css",l.href="css/cmgame.css",document.head.appendChild(l),console.warn('No path to CMGame stylesheet provided. For best results, add the following code inside your <head></head> tags:\n\n<link rel="stylesheet" href="js/cmgame/css/cmgame.css" />\n\n')}if(!document.querySelector("meta[name='viewport']")){let c=document.createElement("meta");c.name="viewport",c.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0",document.head.appendChild(c),console.warn('No "meta" viewport tag provided. For best appearance before load, add the following code inside your <head></head> tags:\n\n<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />\n\n')}switch(this.soundOn=t.soundOn||!1,this.musicOn=t.musicOn||!1,this.orientation=t.orientation||null,this.saveName=t.saveName||"",this.state=t.state||{},this.multiTouch=!!t.multiTouch,this.gridStyle=CMColor.LIGHT_GRAY,this.xAxisStyle=CMColor.GRAY,this.yAxisStyle=CMColor.GRAY,this.tickStyleX=CMColor.DARK_GRAY,this.tickStyleY=CMColor.DARK_GRAY,this.tickStyle=CMColor.DARK_GRAY,this.tickStyleOrigin=t.tickStyleOrigin||CMColor.NONE,this.tickLabelStyleX=CMColor.DARK_GRAY,this.tickLabelStyleY=CMColor.DARK_GRAY,this.tickLabelStyle=CMColor.DARK_GRAY,this.tickLabelStyleOrigin=CMColor.NONE,this.gridlineWidth=1,"number"==typeof t.tickFontSize&&(this.tickFontSize=t.tickFontSize),this.tickLabelIf=null,this.tickLabelIfX=null,this.tickLabelIfY=null,this.tickLabelIfOrigin=null,"function"==typeof t.tickLabelIf?this.tickLabelIf=t.tickLabelIf:Array.isArray(t.tickLabelIf)?this.tickLabelIf=function(e){return t.tickLabelIf.includes(e)}:"boolean"==typeof t.tickLabelIf?this.tickLabelIf=function(e){return t.tickLabelIf}:this.tickLabelIf=function(t){return!0},"function"==typeof t.tickLabelIfX?this.tickLabelIfX=t.tickLabelIfX:Array.isArray(t.tickLabelIfX)?this.tickLabelIfX=function(e){return t.tickLabelIfX.includes(e)}:"boolean"==typeof t.tickLabelIfX?this.tickLabelIfX=function(e){return t.tickLabelIfX}:this.tickLabelIfX=this.tickLabelIf,"function"==typeof t.tickLabelIfY?this.tickLabelIfY=t.tickLabelIfY:Array.isArray(t.tickLabelIfY)?this.tickLabelIfY=function(e){return t.tickLabelIfY.includes(e)}:"boolean"==typeof t.tickLabelIfY?this.tickLabelIfY=function(e){return t.tickLabelIfY}:this.tickLabelIfY=this.tickLabelIf,"function"==typeof t.tickLabelIfOrigin?this.tickLabelIfOrigin=t.tickLabelIfOrigin:"boolean"==typeof t.tickLabelIfOrigin?this.tickLabelIfOrigin=function(e){return t.tickLabelIfOrigin}:this.tickLabelIfOrigin=()=>!1,void 0!==t.gridStyle&&(this.gridStyle=t.gridStyle),void 0!==t.gridlineWidth&&(this.gridlineWidth=t.gridlineWidth),void 0!==t.xAxisStyle&&(this.xAxisStyle=t.xAxisStyle),void 0!==t.yAxisStyle&&(this.yAxisStyle=t.yAxisStyle),void 0!==t.tickStyle&&(this.tickStyle=t.tickStyle),this.tickStyleX=t.tickStyleX||this.tickStyle,this.tickStyleY=t.tickStyleY||this.tickStyle,this.tickLabelStyleOrigin=t.tickLabelStyleOrigin||CMColor.NONE,void 0!==t.tickLabelStyle&&(this.tickLabelStyle=t.tickLabelStyle),this.tickLabelStyleX=t.tickLabelStyleX||this.tickLabelStyle,this.tickLabelStyleY=t.tickLabelStyleY||this.tickLabelStyle,this.fullscreen=!1,void 0!==t.fullscreen&&(this.fullscreen=t.fullscreen),this.type=t.type||"graph",this.ignoreNumLock=!1,void 0!==t.ignoreNumLock&&(this.ignoreNumLock=!!t.ignoreNumLock),this.originByRatio=t.originByRatio||[.5,.5],this.sprites=[],this.functions=[],this.tickDistance="number"==typeof t.tickDistance?t.tickDistance:20,this.gridlineDistance="number"==typeof t.gridlineDistance?t.gridlineDistance:this.tickDistance>=40?this.tickDistance/2:this.tickDistance,this.graphScalar=t.graphScalar||this.gridlineDistance,this.graphScalar_Private=this.graphScalar,this.screenScalar=1,this.mouseState=[,,,,,].fill(0),this.mouseStateString="00000",this.started=!1,this.paused=!0,this.animFrameId=null,this.frameDelay_Private=CMGame.MIN_FRAME_DELAY,this.frameDelay=this.frameDelayPrivate,this.fps_Private=t.fps||CMGame.MAX_FPS,this.fps=this.fps_Private,this.gameOver=!1,this.frameCount=0,this.frameCap="number"==typeof t.frameCap?t.frameCap:1e5,this.leftMousePressed=!1,this.rightMousePressed=!1,this.middleMousePressed=!1,this.trackedScreenTouches={},this.numPressPoints=0,this.latestPoint=null,this.latestSwipes=[],this.latestSwipeStrings=[],this.latestSwipeStrings8=[],this.latestSwipePath=[],this.latestSwipePath8=[],this.hideOnStart=t.hideOnStart,this.wrapper=null,typeof t.wrapper){case"object":this.wrapper=t.wrapper;break;case"string":this.wrapper=document.querySelector(t.wrapper),null===this.canvas&&console.error(t.wrapper+" is not a valid CSS selector, or returned null");break;default:this.wrapper=document.getElementById("cmWrapper")}switch(this.wrapper||(this.wrapper=document.createElement("div"),this.wrapper.setAttribute("id","cmWrapper"),documentBody.appendChild(this.wrapper)),this.canvas=null,typeof t.canvas){case"object":this.canvas=t.canvas;break;case"string":this.canvas=document.querySelector(t.canvas),null===this.canvas&&console.error(t.canvas+" is not a valid CSS selector, or returned null");break;default:this.canvas=document.getElementById("cmCanvas")||document.querySelector("canvas")}switch(this.canvas?(void 0===t.width&&(t.width=this.canvas.width),void 0===t.height&&(t.height=this.canvas.height)):(this.canvas=document.createElement("canvas"),t.width=t.width||640,t.height=t.height||480,this.canvas.classList.add("cm-shadow-almost_black")),this.canvas.hasAttribute("id")||this.canvas.setAttribute("id","cmCanvas"),this.canvas.parentNode!==this.wrapper&&this.wrapper.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.backgroundCanvas=null,typeof t.backgroundCanvas){case"object":this.backgroundCanvas=t.backgroundCanvas;break;case"string":this.backgroundCanvas=document.querySelector(t.backgroundCanvas),null===this.backgroundCanvas&&console.error(t.backgroundCanvas+" is not a valid CSS selector, or returned null")}if(this.backgroundCanvas?this.backgroundCtx=this.backgroundCanvas.getContext("2d"):this.backgroundCtx=null,this.devicePixelRatio=window.devicePixelRatio||1,this.canvasReferenceWidth=t.width||640,this.canvasReferenceHeight=t.height||480,this.width=this.canvasReferenceWidth,this.height=this.canvasReferenceHeight,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width,this.canvas.height=this.height,this.backgroundCanvas&&(this.backgroundCanvas.style.width=this.width+"px",this.backgroundCanvas.style.height=this.height+"px",this.backgroundCanvas.width=this.width*this.devicePixelRatio,this.backgroundCanvas.height=this.height*this.devicePixelRatio),this.offscreenCanvas=document.createElement("canvas"),this.offscreenCtx=this.offscreenCanvas.getContext("2d"),this.offscreenCanvas.style.width=this.width+"px",this.offscreenCanvas.style.height=this.height+"px",this.offscreenCanvas.width=Math.floor(this.canvas.width*this.devicePixelRatio),this.offscreenCanvas.height=Math.floor(this.canvas.height*this.devicePixelRatio),this.spriteWorkCanvas=document.createElement("canvas"),this.spriteWorkCtx=this.spriteWorkCanvas.getContext("2d"),this.origin=null,Array.isArray(t.origin)?this.origin=new CMPoint(t.origin[0],t.origin[1],0):"object"==typeof t.origin?this.origin=new CMPoint(t.origin.x,t.origin.y,0):this.origin=new CMPoint(this.originByRatio[0]*this.width,this.originByRatio[1]*this.height),this.center=Object.freeze(new CMPoint(.5*this.width,.5*this.height)),this.supportsPassive=!1,this.passiveFlag=!1,!t.allowContextMenu){let d=function(t){return t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,!1};CMGame.running_Android||(window.addEventListener("contextmenu",d,!1),this.canvas.addEventListener("contextmenu",d,!1));try{let u=Object.defineProperty({},"passive",{get:function(){e.supportsPassive=!0,CMGame.running_iOS||(e.passiveFlag={passive:!0})}});window.addEventListener("passivetest",null,u),window.removeEventListener("passivetest",null,u)}catch(g){}}switch(this.pressElement=null,typeof t.pressElement){case"object":this.pressElement=t.pressElement;break;case"string":this.pressElement=document.querySelector(t.pressElement);break;default:this.pressElement=this.canvas}if(this.pressElement.addEventListener("touchstart",e.touchStart.bind(e),e.passiveFlag),this.pressElement.addEventListener("mousedown",e.mouseDown.bind(e),!1),this.pressElement.addEventListener("touchmove",e.touchMove.bind(e),e.passiveFlag),this.pressElement.addEventListener("mousemove",e.mouseMove.bind(e),!1),this.pressElement.addEventListener("touchend",function(i){i.cancelable&&!t.allowContextMenu&&i.preventDefault(),e.touchEnd.call(e,i)},!1),this.pressElement.addEventListener("mouseup",e.mouseUp.bind(e),!1),this.pressElement.addEventListener("click",e.click.bind(e),!1),this.pressElement.addEventListener("dblclick",e.dblClick.bind(e),!1),window.addEventListener("keydown",e.keyDown.bind(e),!1),window.addEventListener("keyup",e.keyUp.bind(e),!1),t.overrideResize||(window.addEventListener("resize",e.resizeCanvas.bind(e),!1),this.resizeCanvas.call(this)),this.unpausedWhenVisible=!0,window.addEventListener("visibilitychange",t=>{"visible"===document.visibilityState?e.unpausedWhenVisible&&e.unpause():"hidden"===document.visibilityState&&(e.unpausedWhenVisible=!e.paused,e.unpausedWhenVisible&&e.pause())},!1),this.orientationLock=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation||null,!this.orientationLock&&screen.orientation&&(this.orientationLock=screen.orientation.lock||CMGame.noop),this.runCycle=this.updateAndDraw.bind(this),this.startBtn=null,Array.isArray(t.startBtn))t.startBtn.forEach((t,i)=>{let s;s="string"==typeof t?document.querySelector(t):t,0===i&&(e.startBtn=s),null===s?console.error("Cannot use null reference as start button."):s.addEventListener("click",t=>{t.preventDefault(),e.start(s)},!1)});else{switch(typeof t.startBtn){case"object":this.startBtn=t.startBtn;break;case"string":this.startBtn=document.querySelector(t.startBtn);break;default:this.startBtn=this.canvas}"string"==typeof t.startBtn&&document.querySelectorAll(t.startBtn).length>1?document.querySelectorAll(t.startBtn).forEach(t=>{t.addEventListener("click",i=>{i.preventDefault(),e.start(t)},!1)}):this.startBtn.addEventListener("click",t=>{t.preventDefault(),e.start(e.startBtn)},!1)}switch(this.enterFullscreenBtn=null,this.exitFullscreenBtn=null,typeof t.enterFullscreenBtn){case"object":this.enterFullscreenBtn=t.enterFullscreenBtn,void 0===this.fullscreen&&(this.fullscreen=!0);break;case"string":this.enterFullscreenBtn=document.querySelector(t.enterFullscreenBtn),void 0===this.fullscreen&&(this.fullscreen=!0);break;default:this.enterFullscreenBtn=this.startBtn}switch(typeof t.exitFullscreenBtn){case"object":this.exitFullscreenBtn=t.exitFullscreenBtn;break;case"string":this.exitFullscreenBtn=document.querySelector(t.exitFullscreenBtn);break;default:this.exitFullscreenBtn=null}switch(this.fullscreen&&(this.enterFullscreenBtn.addEventListener("click",t=>{t.preventDefault(),e.enterFullscreen(e.orientation)},!1),this.exitFullscreenBtn&&this.exitFullscreenBtn.addEventListener("click",t=>{t.preventDefault(),e.exitFullscreen()},!1)),this.screenshotLink=document.createElement("a"),this.screenshotLink.href="",this.screenshotLink.download="cmgscreenshot.png",this.screenshotLink.style.display="none",documentBody.appendChild(this.screenshotLink),this.screenshotBtn=null,t.screenshotBtn&&(this.screenshotBtn=document.querySelector(t.screenshotBtn),this.screenshotBtn.addEventListener("click",t=>{t.preventDefault(),e.takeScreenshot()},!1)),this.videoRecorder=null,this.screenVideoLink=document.createElement("a"),this.screenVideoLink.href="",this.screenVideoLink.download="cmgscreenvideo.mp4",this.screenVideoLink.style.display="none",documentBody.appendChild(this.screenVideoLink),"none"===this.type&&(this.draw=function(t=this.offscreenCtx){for(let e of(t.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),this.onbeforedraw(t),this.sprites))e.onbeforedraw(t),t.save(),t.globalAlpha=e.opacity,e.draw(t),t.restore(),e.ondraw(t);for(let i of this.doodles)i.draw(t);this.ondraw(t),this.recordingVideo&&(this.screenVideoCtx.clearRect(0,0,this.screenVideoCanvas.width,this.screenVideoCanvas.height),this.screenVideoCtx.drawImage(game.canvas,this.screenVideoDetails.x,this.screenVideoDetails.y,this.screenVideoDetails.width,this.screenVideoDetails.height))}),this.vennSets=null,this.vennRegions=null,this.vertices=[],this.edges=[],this.type){case"venn":this.vennSets=new Map,this.vennRegions=new Map,this.setNumberOfSets(t.numSets||0,t.variation||0),this.update=function(t){for(let[e,i]of(this.onbeforeupdate(t),this.frameoutFunctions.has(t)&&(this.frameoutFunctions.get(t).call(this,t),this.frameoutFunctions.delete(t)),this.vennRegions))i.update(t);for(let[s,n]of this.vennSets)n.update(t);for(let h of this.sprites)h.onbeforeupdate(t),h.update(t),h.onupdate(t);this.onupdate(t)},this.draw=function(t=this.offscreenCtx){for(let[e,i]of(t.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),this.onbeforedraw(t),this.vennRegions))i.onbeforedraw(t),i.draw(t),i.ondraw(t);for(let[s,n]of this.vennSets)n.onbeforedraw(t),n.draw(t),n.ondraw(t);t.fillStyle=CMColor.BLACK;let h=Math.floor(this.width/16);for(let a of(t.font=`italic ${h}px Times New Roman, serif`,t.fillText("U",this.width-1.5*h,1.25*h),this.sprites))a.onbeforedraw(t),t.save(),t.globalAlpha=a.opacity,a.draw(t),t.restore(),a.ondraw(t);for(let o of this.doodles)o.draw(t);this.ondraw(t),this.recordingVideo&&(this.screenVideoCtx.clearRect(0,0,this.screenVideoCanvas.width,this.screenVideoCanvas.height),this.screenVideoCtx.drawImage(game.canvas,this.screenVideoDetails.x,this.screenVideoDetails.y,this.screenVideoDetails.width,this.screenVideoDetails.height))};break;case"graphtheory":this.vertices=[],this.edges=[],this.update=function(t){for(let e of(this.onbeforeupdate(t),this.frameoutFunctions.has(t)&&(this.frameoutFunctions.get(t).call(this,t),this.frameoutFunctions.delete(t)),this.edges))e.onbeforeupdate(t),e.update(t),e.onupdate(t);for(let i of this.vertices)i.onbeforeupdate(t),i.update(t),i.onupdate(t);for(let s of this.sprites)s.onbeforeupdate(t),s.update(t),s.onupdate(t);this.onupdate(t)},this.draw=function(t=this.offscreenCtx){for(let e of(t.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),this.onbeforedraw(t),this.edges))e.onbeforedraw(t),e.draw(t),e.ondraw(t);for(let i of this.vertices)i.onbeforedraw(t),i.draw(t),i.ondraw(t);for(let s of this.sprites)s.onbeforedraw(t),t.save(),t.globalAlpha=s.opacity,s.draw(t),t.restore(),s.ondraw(t);for(let n of this.doodles)n.draw(t);this.ondraw(t),this.recordingVideo&&(this.screenVideoCtx.clearRect(0,0,this.screenVideoCanvas.width,this.screenVideoCanvas.height),this.screenVideoCtx.drawImage(game.canvas,this.screenVideoDetails.x,this.screenVideoDetails.y,this.screenVideoDetails.width,this.screenVideoDetails.height))};break;case"all":this.vertices=[],this.edges=[],this.vennSets=new Map,this.vennRegions=new Map,this.setNumberOfSets(t.numSets||0,t.variation||0),this.update=function(t){for(let[e,i]of(this.onbeforeupdate(t),this.frameoutFunctions.has(t)&&(this.frameoutFunctions.get(t).call(this,t),this.frameoutFunctions.delete(t)),this.vennRegions))i.update(t);for(let[s,n]of this.vennSets)n.update(t);for(let h of this.edges)h.onbeforeupdate(t),h.update(t),h.onupdate(t);for(let a of this.vertices)a.onbeforeupdate(t),a.update(t),a.onupdate(t);for(let o of this.sprites)o.onbeforeupdate(t),o.update(t),o.onupdate(t);this.onupdate(t)},this.draw=function(t=this.offscreenCtx){if(t.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),this.onbeforedraw(t),this.gridStyle&&this.gridStyle!==CMColor.NONE){t.strokeStyle=this.gridStyle,t.lineWidth=this.gridlineWidth,t.beginPath();for(let e=this.origin.x;e>0;e-=this.gridlineDistance)t.moveTo(e,0),t.lineTo(e,this.canvas.height);for(let i=this.origin.x;i<this.width;i+=this.gridlineDistance)t.moveTo(i,0),t.lineTo(i,this.canvas.height);for(let s=this.origin.y;s>0;s-=this.gridlineDistance)t.moveTo(0,s),t.lineTo(this.canvas.width,s);for(let n=this.origin.y;n<this.height;n+=this.gridlineDistance)t.moveTo(0,n),t.lineTo(this.canvas.width,n);t.stroke()}this.xAxisStyle&&this.xAxisStyle!==CMColor.NONE&&(t.strokeStyle=this.xAxisStyle,this.drawLine(0,this.origin.y,this.width,this.origin.y)),this.yAxisStyle&&this.yAxisStyle!==CMColor.NONE&&(t.strokeStyle=this.yAxisStyle,this.drawLine(this.origin.x,0,this.origin.x,this.height));let h=this.tickDistance/this.graphScalar,a=this.tickFontSize||Math.max(10,Math.min(Math.ceil(.55*this.gridlineDistance),Math.ceil(.55*this.tickDistance)));if(t.font=a+"px Arial, sans-serif",t.textBaseline="middle",this.tickStyleOrigin&&this.tickStyleOrigin!==CMColor.NONE){let o=Math.max(Math.min(5,.25*this.tickDistance),3);t.strokeStyle=this.tickStyleOrigin,this.drawLine(this.origin.x,this.origin.y-o,this.origin.x,this.origin.y+o)}if(this.tickLabelStyleOrigin&&this.tickLabelStyleOrigin!==CMColor.NONE){let r=Math.max(Math.min(5,.25*this.tickDistance),3);t.fillStyle=this.tickLabelStyleOrigin;let l=this.tickLabelIfOrigin(0),c=r;this.yAxisStyle&&this.yAxisStyle!==CMColor.NONE||(c=0),"string"==typeof l?t.fillText(l,this.origin.x+c-.5*t.measureText(l).width,this.origin.y+r+.75*a):"number"==typeof l?t.fillText(""+l,this.origin.x+c-.5*t.measureText(l+"").width,this.origin.y+r+.75*a):l&&t.fillText("0",this.origin.x+c-.5*t.measureText("0").width,this.origin.y+r+.75*a)}if(this.tickStyle&&this.tickStyle!==CMColor.NONE){let d=Math.max(Math.min(5,.25*this.tickDistance),3);t.strokeStyle=this.tickStyleX,t.fillStyle=this.tickLabelStyleX;for(let u=this.origin.x-this.tickDistance,g=-h;u>0;u-=this.tickDistance,g-=h){this.drawLine(u,this.origin.y-d,u,this.origin.y+d);let f=this.tickLabelIfX(g);"string"==typeof f?t.fillText(f,u-.5*t.measureText(f).width,this.origin.y+d+.75*a):"number"==typeof f?f<0?t.fillText(""+f,u-t.measureText(""+f).width+t.measureText("-").width,this.origin.y+d+.75*a):t.fillText(f,u-.5*t.measureText(""+f).width,this.origin.y+d+.75*a):f&&t.fillText(""+g,u-t.measureText(""+g).width+t.measureText("-").width,this.origin.y+d+.75*a)}for(let m=this.origin.x+this.tickDistance,p=h;m<this.width;m+=this.tickDistance,p+=h){this.drawLine(m,this.origin.y-d,m,this.origin.y+d);let y=this.tickLabelIfX(p);"string"==typeof y?t.fillText(y,m-.5*t.measureText(y).width,this.origin.y+d+.75*a):"number"==typeof y?y<0?t.fillText(""+y,m-t.measureText(""+y).width+t.measureText("-").width,this.origin.y+d+.75*a):t.fillText(y,m-.5*t.measureText(""+y).width,this.origin.y+d+.75*a):y&&t.fillText(""+p,m-.5*t.measureText(""+p).width,this.origin.y+d+.75*a)}t.strokeStyle=this.tickStyleY,t.fillStyle=this.tickLabelStyleY;for(let x=this.origin.y-this.tickDistance,$=h;x>0;x-=this.tickDistance,$+=h){this.drawLine(this.origin.x-d,x,this.origin.x+d,x);let w=this.tickLabelIfY($);"string"==typeof w?t.fillText(w,this.origin.x-d-1.25*t.measureText(w).width,x):"number"==typeof w?t.fillText(""+w,this.origin.x-d-1.25*t.measureText(""+w).width,x):w&&t.fillText(""+$,this.origin.x-d-1.25*t.measureText(""+$).width,x)}for(let b=this.origin.y+this.tickDistance,v=-h;b<this.height;b+=this.tickDistance,v-=h){this.drawLine(this.origin.x-d,b,this.origin.x+d,b);let S=this.tickLabelIfY(v);"string"==typeof S?t.fillText(S,this.origin.x-d-1.25*t.measureText(S).width,b):"number"==typeof S?t.fillText(""+S,this.origin.x-d-1.25*t.measureText(""+S).width,b):S&&t.fillText(""+v,this.origin.x-d-1.25*t.measureText(""+v).width,b)}}for(let C of this.functions)C.onbeforedraw(t),C.draw(t),C.ondraw(t);let k=this.getVennRegions().concat(this.getVennSets()).concat(this.getEdges()).concat(this.getVertices()).concat(this.getFunctions()).sort((t,e)=>t.layer-e.layer);for(let _=0,T=k.length;_<T;_++)k[_].onbeforedraw(t)&&k[_].onbeforedraw(t),k[_].draw(t),k[_].ondraw(t)&&k[_].ondraw(t);for(let M of this.sprites)M.onbeforedraw(t),t.save(),t.globalAlpha=M.opacity,M.draw(t),t.restore(),M.ondraw(t);for(let P of this.doodles)P.draw(t);this.ondraw(t),this.recordingVideo&&(this.screenVideoCtx.clearRect(0,0,this.screenVideoCanvas.width,this.screenVideoCanvas.height),this.screenVideoCtx.drawImage(game.canvas,this.screenVideoDetails.x,this.screenVideoDetails.y,this.screenVideoDetails.width,this.screenVideoDetails.height))}}this.doodleOptions={enabled:!1},t.doodleOptions&&(this.doodleOptions=t.doodleOptions,void 0===t.doodleOptions.enabled&&(this.doodleOptions.enabled=!0)),this.doodles=[],this.currentDoodle=null,this.zoomLevel=1,this.unzoomedGraphScalar=this.graphScalar,this.unzoomedTickDistance=this.tickDistance,this.unzoomedGridlineDistance=this.gridlineDistance,this.unzoomedOrigin=new CMPoint(this.origin.x,this.origin.y);let f=["ontouchstart","ontouchmove","ontouchend","onmousedown","onmousemove","onmouseup","onclick","onrightclick","onpressstart","onpressmove","onpressend","onswipe","ondblclick","onkeydown","onkeyup","onresize","onbeforezoom","onzoom","onbeforestart","onstart","onbeforeupdate","onupdate","onbeforedraw","ondraw","onload"];for(let m of(this.frameoutFunctions=new Map,f))"function"==typeof t[m]&&(this[m]=t[m].bind(e));this.screenshotCanvas=null,this.screenshotCtx=null,this.screenVideoCanvas=null,this.screenVideoCtx=null,this.recordingVideo=!1,this.screenVideoDetails=null;let p=1920/this.width,y=1080/this.height;p>y?this.screenVideoDetails={x:Math.max((1920-this.width*y)/2,0),y:Math.max((1080-this.height*y)/2,0),width:this.width*y,height:this.height*y}:this.screenVideoDetails={x:Math.max((1920-this.width*p)/2,0),y:Math.max((1080-this.height*p)/2,0),width:this.width*p,height:this.height*p},this.screenVideoCanvas=document.createElement("canvas"),this.screenVideoCanvas.width=1920,this.screenVideoCanvas.height=1080,this.screenVideoCanvas.style.width="1920px",this.screenVideoCanvas.style.height="1080px",this.screenVideoCtx=this.screenVideoCanvas.getContext("2d",{alpha:!1}),this.alertOverlay=document.createElement("div"),this.alertOverlay.classList="cm-overlay",this.alertElement=document.createElement("aside"),this.alertElement.setAttribute("id","cmAlert");let x=document.createElement("header"),$=document.createElement("h3");this.alertMessage=document.createElement("p"),this.alertMessage.classList.add("cm-center-text");let w=document.createElement("p");w.classList.add("cm-center-text"),this.alertInput=document.createElement("input"),this.alertInput.type="text",this.alertInput.style.background="white",this.alertOKButton=document.createElement("button"),this.alertOKButton.className="cm-dark_green cm-text-white",this.alertOKButton.setAttribute("id","cmAlertOKBtn"),this.alertOKButton.innerText="OK",this.alertInput.onkeydown=function(t){13===t.keyCode&&(t.preventDefault(),e.alertOKButton.click())},this.alertCancelButton=document.createElement("button"),this.alertCancelButton.className="cm-gray cm-text-white",this.alertCancelButton.setAttribute("id","cmAlertCancelBtn"),this.alertCancelButton.innerText="Cancel",this.alertOverlay.appendChild(this.alertElement),$.innerText=(document.title||"Game")+" says:",x.appendChild($),this.alertElement.appendChild(x),this.alertElement.appendChild(this.alertMessage),this.alertOverlay.onkeydown=function(){},w.appendChild(this.alertInput),w.appendChild(this.alertOKButton),w.appendChild(this.alertCancelButton),this.alertElement.appendChild(w),this.alertOverlay.style.display="none",documentBody.appendChild(this.alertOverlay),this.awaitingAnimFrame=!1,window.requestNextFrame=function(t){e.awaitingAnimFrame=!0,e.paused||(e.animFrameId=requestAnimationFrame(t)),e.awaitingAnimFrame=!1};let b=function(t){return e.awaitingAnimFrame?setTimeout(function(){b(t)},CMGame.MIN_FRAME_DELAY):window.cancelAnimationFrame(t)};if(window.cancelNextFrame=function(t){if(null!==t)return b(t)},"function"==typeof this.onload&&this.onload(),this.debug){try{document.getElementById("cmLoading").style.display="none"}catch(v){}let S=t.debugOptions||{};this.tickStyle===CMColor.NONE&&void 0===S.tickStyle&&(this.tickStyle="rgba(60, 30, 0, 0.5)"),this.gridStyle===CMColor.NONE&&void 0===S.gridStyle&&(this.gridStyle="rgba(65, 65, 65, 0.5)"),this.xAxisStyle===CMColor.NONE&&void 0===S.xAxisStyle&&(this.xAxisStyle="rgba(65, 65, 255, 0.5)"),this.yAxisStyle===CMColor.NONE&&void 0===S.yAxisStyle&&(this.yAxisStyle="rgba(255, 65, 65, 0.5)"),window.addEventListener("load",function(){e.start(e.startBtn)},!1)}}rel(t){return"number"==typeof t?t/self.screenScalar:{x:t.x/self.screenScalar,y:t.y/self.screenScalar}}takeScreenshot(t={}){let e=this.canvas.toDataURL(),i=this,s=new Image,n,h,a={filename:t.filename||"cmgscreenshot.png",output:t.output||"download"};return new Promise(function(t,o){s.onload=function(){i.screenshotCanvas||(i.screenshotCanvas=document.createElement("canvas"),i.screenshotCtx=i.screenshotCanvas.getContext("2d")),i.screenshotCanvas.style.width=(i.screenshotCanvas.width=i.canvas.width)+"px",i.screenshotCanvas.style.height=(i.screenshotCanvas.height=i.canvas.height)+"px";let e=window.getComputedStyle(i.canvas),r=e.getPropertyValue("background-image");if(i.backgroundCanvas)i.screenshotCtx.drawImage(i.backgroundCanvas,0,0,i.screenshotCanvas.width,i.screenshotCanvas.height);else if(r&&r.startsWith("url")){let l=r.replace("url(","").replace(")",""),c=new Image;c.onerror=function(t){o("Error loading background image source for screenshot")},c.onload=function(){let o=e.getPropertyValue("background-position-x")||0,r=e.getPropertyValue("background-position-y")||0,l=e.getPropertyValue("background-repeat-x")||"repeat",d=e.getPropertyValue("background-repeat-y")||"repeat",u=i.screenshotCanvas.width,g=i.screenshotCanvas.height,f=e.getPropertyValue("background-size").split(" ");f.length>1?(f[0].includes("px")&&(u=parseFloat(f[0].replace("px",""))),f[1].includes("px")&&(g=parseFloat(f[1].replace("px","")))):u=g=parseFloat(f[0].replace("px",""));for(let m=r;m<i.screenshotCanvas.height||"no-repeat"===d;m+=g)for(let p=o;p<i.screenshotCanvas.width||"no-repeat"===l;p+=u)i.screenshotCtx.drawImage(c,p,m,u,g);i.screenshotCtx.drawImage(s,0,0,i.screenshotCanvas.width,i.screenshotCanvas.height),h=i.screenshotCanvas.toDataURL(),i.screenshotLink.href=h,i.screenshotLink.download=a.filename,"download"===a.output&&i.screenshotLink.click(),(n=a.output instanceof HTMLImageElement?a.output:new Image).onload=()=>{t({image:n,src:n.src})},n.src=canvas.dataUrl},c.src=l;return}else i.screenshotCtx.fillStyle=e.getPropertyValue("background-color"),i.screenshotCtx.fillRect(0,0,i.screenshotCanvas.width,i.screenshotCanvas.height);i.screenshotCtx.drawImage(s,0,0,i.screenshotCanvas.width,i.screenshotCanvas.height),h=i.screenshotCanvas.toDataURL(),i.screenshotLink.href=h,i.screenshotLink.download=a.filename,"download"===a.output&&i.screenshotLink.click(),(n=a.output instanceof HTMLImageElement?a.output:new Image).onload=()=>{t({image:n,src:n.src})},n.src=h},s.src=e})}takeScreenVideo(t={}){if(this.recordingVideo)return console.error("Cannot record multiple videos simultaneously"),Promise.resolve({video:null,src:""});let e=this,i={start:0,duration:5e3,fps:this.fps,mimeType:"video/mp4",filename:"cmgscreenvideo.mp4",output:"download"};switch(typeof t){case"number":i.duration=t;break;case"object":for(let s in i)void 0!==t[s]&&(i[s]=t[s])}let n,h;"string"!=typeof t.filename||("string"==typeof t.mimeType?(h=({"x-msvideo":".avi",mp4:".mp4",mpeg:".mpeg",ogg:".ogv",mp2t:".ts",webm:".webm","3gpp":".3gp","3gpp2":".3g2"})[n=t.mimeType.match(/video\/([a-z0-9\-]+)/)[0].replace("video/","")],t.filename.endsWith(h)||(console.warn(`takeScreenVideo "filename" does not match "mimeType".
						Inferred extension will be appended to filename.`),i.filename=t.filename+h)):(n=({avi:"x-msvideo",mp4:"mp4",mpeg:"mpeg",ogv:"ogg",ts:"mp2t",webm:"webm","3gp":"3gpp","3g2":"3gpp2"})[h=t.filename.substr(t.filename.lastIndexOf(".")+1)],i.mimeType="video/"+n));let a=i.duration/1e3,o=Math.ceil(i.fps*a);return new Promise(function(t,s){let n=e.screenVideoCanvas.captureStream(i.fps),h=[];e.videoRecorder=new MediaRecorder(n,{mimeType:"video/webm; codecs=vp9"}),e.videoRecorder.ondataavailable=function(t){t.data.size>0&&h.push(t.data)},e.videoRecorder.onstart=function(){"indefinite"!==i.duration&&e.setFrameout(()=>{e.videoRecorder.stop(),e.recordingVideo=!1},o)},e.videoRecorder.onstop=function(){let s=new Blob(h,{type:i.mimeType}),n=URL.createObjectURL(s),a={video:null,src:""};i.output instanceof HTMLVideoElement?(i.output.src=n,a.video=i.output,a.src=i.output.src):"download"===i.output&&(e.screenVideoLink.href=n,e.screenVideoLink.download=i.filename,a.video=null,a.src=e.screenVideoLink.href,e.screenVideoLink.click()),h=[],window.URL.revokeObjectURL(n),e.videoRecorder=null,t(a)},setTimeout(()=>{e.videoRecorder.start(),e.recordingVideo=!0},i.start)})}startScreenVideo(){return this.recordingVideo?(console.error("Cannot record multiple videos simultaneously"),Promise.resolve()):this.takeScreenVideo({duration:"indefinite"})}stopScreenVideo(){this.videoRecorder&&this.recordingVideo?(this.videoRecorder.stop(),this.recordingVideo=!1):console.warn("No video to stop")}start(t){let e=this;if(this.started)return this;if("function"==typeof this.onbeforestart&&this.onbeforestart(t),Array.isArray(this.hideOnStart))for(let i of this.hideOnStart)"object"==typeof i?elm.style.display="none":"string"==typeof i&&null!==document.querySelector(i)&&(document.querySelector(i).style.display="none");return this.started=!0,this.paused=!1,this.animFrameId=requestAnimationFrame(function(){if(e.runCycle(),"function"==typeof e.onstart)try{e.onstart(t)}catch(i){console.error(i),console.log(`CMGame engine says: Chaining on creation may lead to an initialization error if your onstart() method references the current game instance. Try separating the .start() call from initialization. For instance,

					const game = new CMGame();
					game.start();`)}}),this}pause(){return this.paused=!0,window.cancelNextFrame(this.animFrameId),this.animFrameId=null,this}unpause(){return this.paused&&(this.paused=!1,null===this.animFrameId&&(this.animFrameId=requestNextFrame(this.runCycle))),this}onbeforeupdate(t){}onupdate(t){}onbeforedraw(t){}ondraw(t){}onbeforezoom(t,e){}onzoom(t,e){}ontouchstart(t){}ontouchmove(t){}ontouchend(t){}onmousedown(t){}onmousemove(t){}onmouseup(t){}onclick(t){}ondblclick(t){}onrightclick(t){}onpressstart(t){}onpressmove(t){}onpressend(t){}onkeydown(t){}onkeyup(t){}update(t){for(let e of(this.onbeforeupdate(t),this.frameoutFunctions.has(t)&&(this.frameoutFunctions.get(t).call(this,t),this.frameoutFunctions.delete(t)),this.functions))e.update(t);for(let i=0,s=this.sprites.length;i<s;i++){let n=this.sprites[i];for(n.onbeforeupdate(t),n.update(t),n.onupdate(t);this.sprites.length<s;)i--,s--}this.onupdate(t)}draw(t=this.offscreenCtx){if(t.clearRect(0,0,this.width,this.height),this.onbeforedraw(t),this.gridStyle&&this.gridStyle!==CMColor.NONE){t.strokeStyle=this.gridStyle,t.lineWidth=this.gridlineWidth,t.beginPath();for(let e=this.origin.x;e>0;e-=this.gridlineDistance)t.moveTo(e,0),t.lineTo(e,this.canvas.height);for(let i=this.origin.x;i<this.width;i+=this.gridlineDistance)t.moveTo(i,0),t.lineTo(i,this.canvas.height);for(let s=this.origin.y;s>0;s-=this.gridlineDistance)t.moveTo(0,s),t.lineTo(this.canvas.width,s);for(let n=this.origin.y;n<this.height;n+=this.gridlineDistance)t.moveTo(0,n),t.lineTo(this.canvas.width,n);t.stroke()}this.xAxisStyle&&this.xAxisStyle!==CMColor.NONE&&(t.strokeStyle=this.xAxisStyle,this.drawLine(0,this.origin.y,this.width,this.origin.y)),this.yAxisStyle&&this.yAxisStyle!==CMColor.NONE&&(t.strokeStyle=this.yAxisStyle,this.drawLine(this.origin.x,0,this.origin.x,this.height));let h=this.tickDistance/this.graphScalar,a=this.tickFontSize||Math.max(10,Math.min(Math.ceil(.55*this.gridlineDistance),Math.ceil(.55*this.tickDistance)));if(t.font=a+"px Arial, sans-serif",t.textBaseline="middle",this.tickStyleOrigin&&this.tickStyleOrigin!==CMColor.NONE){let o=Math.max(Math.min(5,.25*this.tickDistance),3);t.strokeStyle=this.tickStyleOrigin,this.drawLine(this.origin.x,this.origin.y-o,this.origin.x,this.origin.y+o)}if(this.tickLabelStyleOrigin&&this.tickLabelStyleOrigin!==CMColor.NONE){let r=Math.max(Math.min(5,.25*this.tickDistance),3);t.fillStyle=this.tickLabelStyleOrigin;let l=r;this.yAxisStyle&&this.yAxisStyle!==CMColor.NONE||(l=0);let c=this.tickLabelIfOrigin(0);"string"==typeof c?t.fillText(c,this.origin.x+l-.5*t.measureText(c).width,this.origin.y+r+.75*a):"number"==typeof c?t.fillText(""+c,this.origin.x+l-.5*t.measureText(c+"").width,this.origin.y+r+.75*a):c&&t.fillText("0",this.origin.x+l-.5*t.measureText("0").width,this.origin.y+r+.75*a)}if(this.tickStyle&&this.tickStyle!==CMColor.NONE){let d=Math.max(Math.min(5,.25*this.tickDistance),3);t.strokeStyle=this.tickStyleX,t.fillStyle=this.tickLabelStyleX;for(let u=this.origin.x-this.tickDistance,g=-h;u>0;u-=this.tickDistance,g-=h){this.drawLine(u,this.origin.y-d,u,this.origin.y+d);let f=this.tickLabelIfX(g);"string"==typeof f?t.fillText(f,u-.5*t.measureText(f).width,this.origin.y+d+.75*a):"number"==typeof f?f<0?t.fillText(""+f,u-t.measureText(""+f).width+t.measureText("-").width,this.origin.y+d+.75*a):t.fillText(f,u-.5*t.measureText(""+f).width,this.origin.y+d+.75*a):f&&t.fillText(""+g,u-t.measureText(""+g).width+t.measureText("-").width,this.origin.y+d+.75*a)}for(let m=this.origin.x+this.tickDistance,p=h;m<this.width;m+=this.tickDistance,p+=h){this.drawLine(m,this.origin.y-d,m,this.origin.y+d);let y=this.tickLabelIfX(p);"string"==typeof y?t.fillText(y,m-.5*t.measureText(y).width,this.origin.y+d+.75*a):"number"==typeof y?y<0?t.fillText(""+y,m-t.measureText(""+y).width+t.measureText("-").width,this.origin.y+d+.75*a):t.fillText(y,m-.5*t.measureText(""+y).width,this.origin.y+d+.75*a):y&&t.fillText(""+p,m-.5*t.measureText(""+p).width,this.origin.y+d+.75*a)}t.strokeStyle=this.tickStyleY,t.fillStyle=this.tickLabelStyleY;for(let x=this.origin.y-this.tickDistance,$=h;x>0;x-=this.tickDistance,$+=h){this.drawLine(this.origin.x-d,x,this.origin.x+d,x);let w=this.tickLabelIfY($);"string"==typeof w?t.fillText(w,this.origin.x-d-1.25*t.measureText(w).width,x):"number"==typeof w?t.fillText(w,this.origin.x-d-1.25*t.measureText(""+w).width,x):w&&t.fillText(""+$,this.origin.x-d-1.25*t.measureText(""+$).width,x)}for(let b=this.origin.y+this.tickDistance,v=-h;b<this.height;b+=this.tickDistance,v-=h){this.drawLine(this.origin.x-d,b,this.origin.x+d,b);let S=this.tickLabelIfY(v);"string"==typeof S?t.fillText(S,this.origin.x-d-1.25*t.measureText(S).width,b):"number"==typeof S?t.fillText(S,this.origin.x-d-1.25*t.measureText(""+S).width,b):S&&t.fillText(""+v,this.origin.x-d-1.25*t.measureText(""+v).width,b)}}for(let C of this.functions)C.onbeforedraw(t),C.draw(t),C.ondraw(t);for(let k of this.sprites)k.onbeforedraw(t),t.save(),t.globalAlpha=k.opacity,k.draw(t),t.restore(),k.ondraw(t);for(let _ of this.doodles)_.draw(t);this.ondraw(t),this.recordingVideo&&(this.screenVideoCtx.clearRect(game.canvas,0,0,this.screenVideoCanvas.width,this.screenVideoCanvas.height),this.screenVideoCtx.drawImage(game.canvas,this.screenVideoDetails.x,this.screenVideoDetails.y,this.screenVideoDetails.width,this.screenVideoDetails.height))}startDoodle(t,e=this.doodleOptions){return this.doodleOptions.enabled=!0,e.startPoint=new CMPoint(t.x,t.y),this.currentDoodle=new CMDoodle(this,e),this.doodles.push(this.currentDoodle),this}stopDoodle(){return this.currentDoodle=null,this}undoDoodle(){return this.doodles.pop(),(this.paused||!this.started)&&this.draw(),this}clearDoodles(t){return void 0===t?CMGame.clearAll(this.doodles):this.doodles=this.doodles.filter(e=>!t.includes(e)),this.currentDoodle=null,(this.paused||!this.started)&&this.draw(),this}spriteFromDoodles(t,e=!1){let i=t||this.doodles;if(0===i.length)return null;let s,n=this.canvas.width,h=this.canvas.height,a=0,o=0,r=0,l=0;for(let c=0;c<i.length;c++)n=Math.min(n,Math.min.apply(Math,i[c].points.map(t=>t.x))),h=Math.min(h,Math.min.apply(Math,i[c].points.map(t=>t.y))),a=Math.max(a,Math.max.apply(Math,i[c].points.map(t=>t.x))),o=Math.max(o,Math.max.apply(Math,i[c].points.map(t=>t.y)));r=a-n,l=o-h,1===i[0].points.length&&i[0].addPoint(i[0].startPoint.x+.5,i[0].startPoint.y+.5);let d=[i[0].path],u=1,g=[i[0].strokeStyle],f=[i[0].fillStyle],m=[i[0].lineWidth];for(let p=1;p<i.length;p++)1===i[p].points.length&&i[p].addPoint(i[p].startPoint.x+.5,i[p].startPoint.y+.5),d.push(i[p].path),u++,g.push(i[p].strokeStyle),f.push(i[p].fillStyle),m.push(i[p].lineWidth);return s=new CMSprite(this,n,h,r,l,function(t){t.save(),t.translate(this.x-n,this.y-h);for(let e=0;e<u;e++)t.fillStyle=f[e],t.fill(d[e]),t.strokeStyle=g[e],t.lineWidth=m[e],t.stroke(d[e]);t.restore()}),e||this.clearDoodles(i),s}spriteFromDoodle(t,e=!1){let i=[];if(t)i=[t];else{if(!(game.doodles.length>0))return null;i=[CMGame.last(game.doodles)]}let s=this.spriteFromDoodles(i,!0);return e||-1===this.doodles.indexOf(i[0])||this.doodles.splice(this.doodles.indexOf(i[0]),1),s}spriteFromDoodlesAsync(t,e=!1){let i=this.spriteFromDoodle(t,e);return document.createElement("canvas"),this.spriteWorkCanvas.style.width=(this.spriteWorkCanvas.width=i.width)+"px",this.spriteWorkCtx.save(),this.spriteWorkCtx.translate(-i.x,-i.y),i.draw(this.spriteWorkCtx),this.spriteWorkCtx.restore(),new Promise(function(t,e){let s=new Image;s.onload=function(){t(new CMSprite(game,0,0,i.width,i.height,s))},s.src=this.spriteWorkCanvas.toDataUrl()})}spriteFromDoodleAsync(t,e=!1){let i=this.spriteFromDoodle(t,e);return document.createElement("canvas"),this.spriteWorkCanvas.style.width=(this.spriteWorkCanvas.width=i.width)+"px",this.spriteWorkCtx.save(),this.spriteWorkCtx.translate(-i.x,-i.y),i.draw(this.spriteWorkCtx),this.spriteWorkCtx.restore(),new Promise(function(t,e){let s=new Image;s.onload=function(){t(new CMSprite(game,0,0,i.width,i.height,s))},s.src=this.spriteWorkCanvas.toDataUrl()})}spriteFromFunction(t,e=!1){let i=new Path2D(t.path),s=t.strokeStyle,n=t.lineWidth,h=null,a=CMColor.NONE,o=null,r=CMColor.NONE;t.pathBelow&&t.fillStyleBelow&&t.fillStyleBelow!==CMColor.NONE&&(h=t.pathBelow,a=t.fillStyleBelow),t.pathAbove&&t.fillStyleAbove&&t.fillStyleAbove!==CMColor.NONE&&(o=t.pathAbove,r=t.fillStyleAbove);let l,c,d,u;switch(t.type){case"cartesian":l=Math.max(0,this.xToScreen(t.start.x)),c=Math.min.apply(null,t.screenValsArray),d=Math.min(this.width,this.xToScreen(t.end.x)),u=Math.max.apply(null,t.screenValsArray);break;case"xofy":c=Math.min(this.height,this.xToScreen(t.end.y)),l=Math.min.apply(null,t.screenValsArray),u=Math.max(0,this.yToScreen(t.start.y)),d=Math.max.apply(null,t.screenValsArray);break;case"parametric":l=t.screenValsArray.reduce((t,e)=>Math.min(t,e.x),game.width),c=t.screenValsArray.reduce((t,e)=>Math.min(t,e.y),game.height),d=t.screenValsArray.reduce((t,e)=>Math.max(t,e.x),0),u=t.screenValsArray.reduce((t,e)=>Math.max(t,e.y),0);break;case"polar":let g=Math.max(...t.screenValsArray);l=t.origin.x-g,c=t.origin.y-g,d=t.origin.x+g,u=t.origin.y+g}let f=new CMSprite(this,l,c,d-l,u-c,function(t){t.lineWidth=n,h&&(t.fillStyle=a,t.fill(h)),o&&(t.fillStyle=r,t.fill(o)),t.strokeStyle=s,t.stroke(i)});return f.containsPoint=function(t,e){let s={},n=this.game;s="number"==typeof t?{x:t,y:e}:t;let a=!1;return n.ctx.save(),n.ctx.lineWidth=this.lineWidth,n.ctx.isPointInStroke(i,s.x,s.y)&&(a=!0),h&&n.ctx.isPointInPath(h,s.x,s.y)&&(a=!0),o&&n.ctx.isPointInPath(o,s.x,s.y)&&(a=!0),n.ctx.restore(),a},!e&&game.has(t)&&game.removeFunction(t),f}addFunction(t){return t instanceof CMFunction&&!this.functions.includes(t)&&this.functions.push(t),this}addFunctions(...t){let e=this,i=t;return 1===arguments.length&&Array.isArray(arguments[0])&&(i=arguments[0]),i.forEach(t=>e.addFunction(t)),this}removeFunction(t){return t&&this.functions.includes(t)&&this.functions.splice(this.functions.indexOf(t),1),this}removeFunctions(...t){let e=t;1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]);let i=e.length;for(;i--;)this.removeFunction(e[i]);return this}addSprite(t){return t&&!this.sprites.includes(t)&&(this.sprites.push(t),this.sprites.sort((t,e)=>t.layer-e.layer)),this}addSprites(...t){let e=this,i=t;return 1===arguments.length&&Array.isArray(arguments[0])&&(i=arguments[0]),i.forEach(t=>e.addSprite(t)),this}removeSprite(t){return t&&this.sprites.includes(t)&&(t.onscreen=!1,this.sprites.splice(this.sprites.indexOf(t),1),"function"==typeof t.ondestroy&&t.ondestroy.call(t)),this}removeSprites(...t){let e=t;1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]);let i=e.length;for(;i--;)this.removeSprite(e[i]);return this}add(...t){let e=t;return 1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]),this.addVertices(e.filter(t=>t instanceof CMVertex)).addEdges(e.filter(t=>t instanceof CMEdge)).addSprites(e.filter(t=>t instanceof CMSprite).filter(t=>!(t instanceof CMVertex)).filter(t=>!(t instanceof CMEdge))).addFunctions(e.filter(t=>t instanceof CMFunction)),this}has(t){return!!(t instanceof CMSprite&&this.sprites.includes(t)||t instanceof CMFunction&&this.functions.includes(t)||t instanceof CMVertex&&this.vertices.includes(t)||t instanceof CMEdge&&this.edges.includes(t)||t instanceof CMDoodle&&this.doodles.includes(t))}remove(...t){let e=t;return 1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]),this.removeVertices(e.filter(t=>t instanceof CMVertex)).removeEdges(e.filter(t=>t instanceof CMEdge)).removeSprites(e.filter(t=>t instanceof CMSprite).filter(t=>!(t instanceof CMVertex)).filter(t=>!(t instanceof CMEdge))).removeFunctions(e.filter(t=>t instanceof CMFunction)),this}xToScreen(t,e=this.origin){let i=this.graphScalar*t;return e.x+i}xToReal(t,e=this.origin){return(t-e.x)/this.graphScalar}yToScreen(t,e=this.origin){let i=this.graphScalar*t;return e.y-i}yToReal(t,e=this.origin){return-(t-e.y)/this.graphScalar}toScreen(t,e=this.origin){return new CMPoint({x:this.xToScreen(t.x,e),y:this.yToScreen(t.y,e)})}toReal(t,e=this.origin){return new CMPoint({x:this.xToReal(t.x,e),y:this.yToReal(t.y,e)})}drawOffscreenToScreen(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.offscreenCanvas,0,0,this.canvas.width,this.canvas.height)}updateAndDraw(){let t=performance.now();if(t-previousFrameTime<CMGame.MIN_FRAME_DELAY){this.started&&!this.paused&&(this.animFrameId=requestNextFrame(this.runCycle));return}previousFrameTime=t,this.update(this.frameCount),this.offscreenCtx.save(),this.offscreenCtx.scale(this.devicePixelRatio,this.devicePixelRatio),this.draw(this.offscreenCtx),this.offscreenCtx.restore(),this.drawOffscreenToScreen(),this.frameCount++,this.frameCount>this.frameCap&&(this.frameCount=0),this.started&&!this.paused&&(this.animFrameId=requestNextFrame(this.runCycle))}resizeCanvas(){let t=this.canvasReferenceWidth,e=this.canvasReferenceHeight,i="width",s={screen:{width:0,height:0},wrapper:{x:0,y:0,width:0,height:0},screenScalar:1};document.documentElement.clientWidth<this.canvasReferenceWidth||document.documentElement.clientHeight<this.canvasReferenceHeight?("width"==(i=document.documentElement.clientWidth<this.canvasReferenceWidth&&document.documentElement.clientHeight<this.canvasReferenceHeight?document.documentElement.clientWidth/this.canvasReferenceWidth<document.documentElement.clientHeight/this.canvasReferenceHeight?"width":"height":document.documentElement.clientWidth<this.canvasReferenceWidth?"width":"height")?(t=Math.min.apply(Math,[document.documentElement.clientWidth,window.outerWidth,window.innerWidth,documentBody.clientWidth]),e=this.canvasReferenceHeight/this.canvasReferenceWidth*t,this.screenScalar=Math.min(t/this.canvasReferenceWidth,e/this.canvasReferenceHeight)):(e=Math.min.apply(Math,[document.documentElement.clientHeight,window.outerHeight,window.innerHeight,documentBody.clientHeight]),t=this.canvasReferenceWidth/this.canvasReferenceHeight*e,this.screenScalar=Math.min(t/this.canvasReferenceWidth,e/this.canvasReferenceHeight)),this.wrapper.style.transform="scale("+this.screenScalar+")",this.wrapper.style.left=`calc(100vw / 2 - ${.5*this.screenScalar} * ${this.width}px)`,this.wrapper.style.top="0",(s={screen:{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},wrapper:{x:document.documentElement.clientWidth/2-.5*this.screenScalar*this.width,y:0,width:this.width*this.screenScalar,height:this.height*this.screenScalar},screenScalar:this.screenScalar,orientation:"landscape"}).screen.width<s.screen.height&&(s.orientation="portrait")):(t=this.canvasReferenceWidth,e=this.canvasReferenceHeight,this.wrapper.style.width=(this.wrapper.width=t)+"px",this.wrapper.style.height=(this.wrapper.height=e)+"px",this.screenScalar=1,this.wrapper.style.transform="scale("+this.screenScalar+")",this.wrapper.style.left=`calc(100vw / 2 - ${.5*this.screenScalar} * ${this.width}px)`,this.wrapper.style.top="18px",(s={screen:{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},wrapper:{x:document.documentElement.clientWidth/2-.5*this.screenScalar*this.width,y:18,width:this.width,height:this.height},screenScalar:this.screenScalar,orientation:"landscape"}).screen.width<s.screen.height&&(s.orientation="portrait")),"function"==typeof this.onresize&&this.onresize(s)}generateSaveName(){let t=0;for(;null!==localStorage.getItem(CMGame.SAVE_PREFIX+t);)t++;return CMGame.SAVE_PREFIX+t}save(t,e){let i="",s={};switch(typeof t){case"string":i=t,s="object"==typeof e?e:this.state;break;case"object":s=t,i=this.saveName;break;default:i=this.saveName,s=this.state}try{localStorage.setItem(i,JSON.stringify(s)),console.log("Saving game data under name: %c"+i,"font-weight: bold; font-size: large; color: white; background-color: rgb(1, 97, 251); display: inline-block; border-radius: 4px; padding: 3px 5px;")}catch(n){console.error("Error thrown during localStorage save. Possible security issue, e.g., when testing save on local directory.")}}load(t){let e=null,i="";"string"==typeof t?i=t:this.saveName?i=this.saveName:"0"!==(i=this.generateSaveName()).replace(CMGame.SAVE_PREFIX,"")&&(i=CMGame.SAVE_PREFIX+(parseInt(i.replace(CMGame.SAVE_PREFIX,""))-1));try{e=localStorage.getItem(i),console.log("Loading game data saved under name: %c"+i,"font-weight: bold; font-size: large; color: white; background-color: rgb(1, 97, 251); display: inline-block; border-radius: 4px; padding: 3px 5px;")}catch(s){console.error("Error thrown during localStorage load. Possible security issue, e.g., when testing save on local directory.")}return null!==e?(this.state=JSON.parse(e),this.state):{}}keyDown(t){switch(this.paused||"INPUT"===t.target.nodeName||"TEXTAREA"===t.target.nodeName||"BUTTON"===t.target.nodeName||t.preventDefault(),t.keyCode){case 38:case 87:case 104+1e3*+!this.ignoreNumLock:t.direction="up";break;case 40:case 83:case 98+1e3*+!this.ignoreNumLock:t.direction="down";break;case 37:case 65:case 100+1e3*+!this.ignoreNumLock:t.direction="left";break;case 39:case 68:case 102+1e3*+!this.ignoreNumLock:t.direction="right";break;default:t.direction=""}this.onkeydown(t)}keyUp(t){switch("INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&"BUTTON"!==t.target.nodeName&&t.preventDefault(),t.keyCode){case 38:case 87:case 104+1e3*+!this.ignoreNumLock:t.direction="up";break;case 40:case 83:case 98+1e3*+!this.ignoreNumLock:t.direction="down";break;case 37:case 65:case 100+1e3*+!this.ignoreNumLock:t.direction="left";break;case 39:case 68:case 102+1e3*+!this.ignoreNumLock:t.direction="right";break;default:t.direction=""}this.onkeyup(t)}click(t){t.preventDefault(),this.onclick(t)}dblClick(t){t.preventDefault(),this.ondblclick(t)}touchStart(t){if(this.passiveFlag||t.preventDefault(),this.numPressPoints=t.touches.length,this.ontouchstart(t),this.multiTouch)for(let e=0;e<t.targetTouches.length;e++)this.pressStart((t.targetTouches[e].clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.targetTouches[e].clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar);else this.pressStart((t.targetTouches[0].clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.targetTouches[0].clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar)}mouseDown(t){switch(t.preventDefault(),this.leftMousePressed=!1,this.middleMousePressed=!1,this.rightMousePressed=!1,t.buttons){case 0:default:this.numPressPoints=0;break;case 1:this.leftMousePressed=!0,this.numPressPoints=1;break;case 2:this.rightMousePressed=!0,this.numPressPoints=1;break;case 3:this.rightMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=2;break;case 4:this.middleMousePressed=!0,this.numPressPoints=1;break;case 5:this.middleMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=2;break;case 6:this.middleMousePressed=!0,this.rightMousePressed=!0,this.numPressPoints=1;break;case 7:this.middleMousePressed=!0,this.rightMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=3}this.numPressPoints=this.toBinary(t.buttons).split("").reduce((t,e)=>t+ +e,0),this.mouseState=[0,+this.leftMousePressed,+this.middleMousePressed,+this.rightMousePressed,0],this.mouseStateString=this.mouseState.join(""),this.onmousedown(t),this.pressStart((t.clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar),2===t.button&&this.onrightclick(t)}pressStart(t,e){null===this.latestPoint&&(this.latestPoint={x:t,y:e}),this.doodleOptions.enabled&&this.startDoodle(new CMPoint(t,e),this.doodleOptions),this.onpressstart({x:t,y:e})}touchMove(t){if(this.passiveFlag||t.preventDefault(),this.numPressPoints=t.touches.length,this.ontouchmove(t),this.multiTouch)for(let e=0;e<t.targetTouches.length;e++)this.pressMove((t.targetTouches[e].clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.targetTouches[e].clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar);else this.pressMove((t.targetTouches[0].clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.targetTouches[0].clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar)}mouseMove(t){switch(t.preventDefault(),this.leftMousePressed=!1,this.middleMousePressed=!1,this.rightMousePressed=!1,t.buttons){case 0:default:this.numPressPoints=0;break;case 1:this.leftMousePressed=!0,this.numPressPoints=1;break;case 2:this.rightMousePressed=!0,this.numPressPoints=1;break;case 3:this.rightMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=2;break;case 4:this.middleMousePressed=!0,this.numPressPoints=1;break;case 5:this.middleMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=2;break;case 6:this.middleMousePressed=!0,this.rightMousePressed=!0,this.numPressPoints=2;break;case 7:this.middleMousePressed=!0,this.rightMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=3}this.numPressPoints=this.toBinary(t.buttons).split("").reduce((t,e)=>t+ +e,0),this.mouseState=[0,+this.leftMousePressed,+this.middleMousePressed,+this.rightMousePressed,0],this.mouseStateString=this.mouseState.join(""),this.onmousemove(t),this.leftMousePressed&&this.pressMove((t.clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar)}pressMove(t,e){let i=t,s=e;null===this.latestPoint?this.latestPoint={x:t,y:e}:this.distance(this.latestPoint,new CMPoint(t,e))>=CMGame.PIXELS_FOR_SWIPE&&(this.onswipe&&this.onswipe(new CMSwipe(this,t,e,this.latestPoint.x,this.latestPoint.y)),i=this.latestPoint.x,s=this.latestPoint.y,this.latestPoint={x:t,y:e}),this.currentDoodle&&this.currentDoodle.addPoint(t,e),this.onpressmove({x:t,y:e,oldX:i,oldY:s,offset:{x:t-i,y:e-s}})}touchEnd(t){if(this.numPressPoints=t.touches.length,this.multiTouch)for(let e=0;e<t.changedTouches.length;e++)this.pressEnd((t.changedTouches[e].clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.changedTouches[e].clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar);else this.pressEnd((t.changedTouches[0].clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.changedTouches[0].clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar)}mouseUp(t){switch(t.preventDefault(),this.leftMousePressed=!1,this.middleMousePressed=!1,this.rightMousePressed=!1,this.numPressPoints=0,t.buttons){case 0:default:this.numPressPoints=0;break;case 1:this.leftMousePressed=!0,this.numPressPoints=1;break;case 2:this.rightMousePressed=!0,this.numPressPoints=1;break;case 3:this.rightMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=2;break;case 4:this.middleMousePressed=!0,this.numPressPoints=1;break;case 5:this.middleMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=2;break;case 6:this.middleMousePressed=!0,this.rightMousePressed=!0,this.numPressPoints=2;break;case 7:this.middleMousePressed=!0,this.rightMousePressed=!0,this.leftMousePressed=!0,this.numPressPoints=3}this.numPressPoints=this.toBinary(t.buttons).split("").reduce((t,e)=>t+ +e,0),this.mouseState=[0,+this.leftMousePressed,+this.middleMousePressed,+this.rightMousePressed,0],this.mouseStateString=this.mouseState.join(""),this.onmouseup(t),this.pressEnd((t.clientX-this.wrapper.offsetLeft+document.scrollingElement.scrollLeft)/this.screenScalar,(t.clientY-this.wrapper.offsetTop+document.scrollingElement.scrollTop)/this.screenScalar)}pressEnd(t,e){this.latestPoint=null,CMGame.clearAll(this.latestSwipes,this.latestSwipeStrings,this.latestSwipeStrings8,this.latestSwipePath,this.latestSwipePath8),this.currentDoodle&&this.stopDoodle(),this.onpressend({x:t,y:e})}areColliding(t,e,i,s,n,h,a,o){if(void 0!==i)return!!(t<=n+a)&&!!(t+i>=n)&&!!(e<=h+o)&&!!(e+s>=h);let r=t,l=r.shape,c=e,d=c.shape;if(l||(l="rect"),d||(d="rect"),"circle"===l){if("circle"===d)return this.distance(r,c)<=r.radius+c.radius;if("rect"===d)return this.areColliding(r.x-r.radius,r.y-r.radius,2*r.radius,2*r.radius,c.x,c.y,c.width,c.height);if("line"===d){if(c.end.x===c.start.x){let u={x:c.start.x,y:Math.min(c.start.y,c.end.y),width:1,height:Math.abs(c.end.y-c.start.y),shape:"rect"};return this.areColliding(r,u)}if(c.end.y===c.start.y){let g={x:Math.min(c.start.x,c.end.x),y:c.start.y,width:Math.abs(c.end.x-c.start.x),height:1,shape:"rect"};return this.areColliding(r,g)}{let f=(c.end.y-c.start.y)/(c.end.x-c.start.x),m=c.start,p=m.y-f*m.x,y=Math.min(c.start.x,c.end.x),x=Math.max(c.start.x,c.end.x);for(let $=0,w=x-y;$<w;$++)if(this.distance(r,{x:$,y:f*$+p})<=r.radius)return!0;return!1}}}if("circle"===d&&"rect"===l)return this.areColliding(r.x,r.y,r.width,r.height,c.x-c.radius,c.y-c.radius,2*c.radius,2*c.radius);if("circle"===d&&"line"===l)return this.areColliding(c,r);if("line"===l&&"line"===d){let b=(r.end.y-r.start.y)/(r.end.x-r.start.x),v=(c.end.y-c.start.y)/(c.end.x-c.start.x);if(b===v)return r.containsPoint(c.start);let S=r.start,C=c.start,k=S.y-b*S.x,_=(C.y-v*C.x-k)/(b-v);return!!(Math.min(r.start.x,r.end.x)<=_&&Math.max(r.start.x,r.end.x)>=_&&Math.min(c.start.x,c.end.x)<=_&&Math.max(c.start.x,c.end.x)>=_)}if("line"===l&&"rect"===d){if(c.containsPoint(r.start)||c.containsPoint(r.end))return!0;let T={x:Math.min(this.start.x,this.end.x),y:Math.min(this.start.y,this.end.y),width:Math.abs(this.end.x-this.start.x),height:Math.abs(this.end.y-this.start.y)};if(!this.areColliding(T,c)||r.end.x===r.start.x||r.end.y===r.start.y)return!1;let M=(r.end.y-r.start.y)/(r.end.x-r.start.x),P=r.start,A=P.y-M*P.x,E=M*c.x+A;if(E>=c.y&&E<=c.y+c.height||(E=M*(c.x+c.width)+A)>=c.y&&E<=c.y+c.height)return!0;let R=(c.y-A)/M;return!!(R>=c.x)&&!!(R<=c.x+c.width)||!!((R=(c.y+c.height-A)/M)>=c.x)&&!!(R<=c.x+c.width)}return"rect"===l&&"line"===d?this.areColliding(c,r):!!(r.x<=c.x+c.width)&&!!(r.x+r.width>=c.x)&&!!(r.y<=c.y+c.height)&&!!(r.y+r.height>=c.y)}distance(t,e,i,s){return(arguments.length>2&&(t=new CMPoint(t,e),e=new CMPoint(i,s)),void 0!==t.z&&void 0!==e.z)?Math.hypot(t.x-e.x,t.y-e.y,t.z-e.z):Math.hypot(t.x-e.x,t.y-e.y)}drawLine(t,e,i,s){return void 0!==i?(this.offscreenCtx.beginPath(),this.offscreenCtx.moveTo(t,e),this.offscreenCtx.lineTo(i,s),this.offscreenCtx.stroke(),this):(this.offscreenCtx.beginPath(),this.offscreenCtx.moveTo(t.x,t.y),this.offscreenCtx.lineTo(e.x,e.y),this.offscreenCtx.stroke(),this)}fillOval(t,e,i,s){this.offscreenCtx.beginPath(),void 0!==s?this.offscreenCtx.ellipse(t+.5*i,e+.5*s,.5*i,.5*s,0,0,Math.TAU,!1):this.offscreenCtx.arc(t,e,i,0,Math.TAU,!1),this.offscreenCtx.fill()}strokeOval(t,e,i,s){this.offscreenCtx.beginPath(),void 0!==s?this.offscreenCtx.ellipse(t+.5*i,e+.5*s,.5*i,.5*s,0,0,Math.TAU,!1):this.offscreenCtx.arc(t,e,i,0,Math.TAU,!1),this.offscreenCtx.stroke()}fillRoundedRect(t,e,i,s,n){i<2*n&&(n=.5*i),s<2*n&&(n=.5*s),this.offscreenCtx.beginPath(),this.offscreenCtx.moveTo(t+n,e),this.offscreenCtx.arcTo(t+i,e,t+i,e+s,n),this.offscreenCtx.arcTo(t+i,e+s,t,e+s,n),this.offscreenCtx.arcTo(t,e+s,t,e,n),this.offscreenCtx.arcTo(t,e,t+i,e,n),this.offscreenCtx.closePath(),this.offscreenCtx.fill()}strokeRoundedRect(t,e,i,s,n){i<2*n&&(n=.5*i),s<2*n&&(n=.5*s),this.offscreenCtx.beginPath(),this.offscreenCtx.moveTo(t+n,e),this.offscreenCtx.arcTo(t+i,e,t+i,e+s,n),this.offscreenCtx.arcTo(t+i,e+s,t,e+s,n),this.offscreenCtx.arcTo(t,e+s,t,e,n),this.offscreenCtx.arcTo(t,e,t+i,e,n),this.offscreenCtx.closePath(),this.offscreenCtx.stroke()}circleIntersectsRect(t,e){let i={x:Math.abs(t.x-e.x),y:Math.abs(t.y-e.y)};return!(i.x>.5*e.width+t.radius)&&!(i.y>.5*e.height+t.radius)&&(!!(i.x<=.5*e.width)||!!(i.y<=.5*e.height)||(i.x-.5*e.width)**2+(i.y-.5*e.height)**2<=t.r**2)}drawRotatedImage(t,...e){let i=e.length,s=e.pop(),n=0,h="center";switch(typeof s){case"number":n=s;break;case"object":n=s.angle,void 0===s.clockwise&&(s.clockwise=!0),s.clockwise&&(n*=-1),s.origin&&"center"!==s.origin&&(h="",s.origin.includes("left")?h+="left":s.origin.includes("right")&&(h+="right"),s.origin.includes("top")?h+=" top":s.origin.includes("bottom")&&(h+=" bottom"),h=h.trim());break;default:n=0}let a=e[0],o=e[1],r=e[2]||t.width,l=e[3]||t.height;i>5&&(a=e[0],o=e[1],r=e[2]||t.width,l=e[3]||t.height);let c={x:null,y:null};return h.includes("left")?c.x=a:h.includes("right")?c.x=a+r:c.x=a+.5*r,h.includes("top")?c.y=o:h.includes("bottom")?c.y=o+l:c.y=o+.5*l,this.offscreenCtx.save(),this.offscreenCtx.translate(c.x,c.y),this.offscreenCtx.rotate(n),this.offscreenCtx.translate(-c.x,-c.y),this.offscreenCtx.drawImage.apply(this.offscreenCtx,[t,...e]),this.offscreenCtx.restore(),new CMPoint(c.x,c.y)}drawStrings(t,e,i,s,n={}){let h={fill:!0,stroke:!1,fillStyles:[],strokeStyles:[],offsets:[]},a={};for(let o in h)a[o]=void 0!==n[o]?n[o]:h[o];if(Array.isArray(t)&&Array.isArray(t[0])){let r=i,l=s;for(let c=0,d=Math.max(t.length,e.length);c<d;c++){let u=10,g=15,f={fill:Array.isArray(a.fill)?a.fill[c]:a.fill,stroke:Array.isArray(a.stroke)?a.stroke[c]:a.stroke,fillStyles:[[]],strokeStyles:[[]],offsets:[[]]};if(Array.isArray(n.fillStyles)&&Array.isArray(n.fillStyles[0])&&(f.fillStyles=n.fillStyles[c]),Array.isArray(n.strokeStyles)&&Array.isArray(n.strokeStyles[0])&&(f.strokeStyles=n.strokeStyles[c]),Array.isArray(n.offsets)&&Array.isArray(n.offsets[0])&&(f.offsets=n.offsets[c]),"number"==typeof n.lineHeight)g=n.lineHeight;else for(let m=0,p=t[0].length;m<p;m++){let y;try{y=t[c][m].match(/[0-9]+[A-Za-z]+/,"")}catch(x){console.error(x)}y&&(g=1.5*(u=Math.max(u,parseInt(y[0]))))}r=Math.max(r,this.drawStrings(t[c],e[c],i,s+c*g,f).x),l+=g}return new CMPoint(r,l)}if("string"==typeof a.fillStyles?a.fillStyles=[a.fillStyles]:a.fillStyles&&a.fillStyles.length||(a.fillStyles=[this.offscreenCtx.fillStyle]),"string"==typeof a.strokeStyles?a.strokeStyles=[a.strokeStyles]:a.strokeStyles&&a.strokeStyles.length||(a.strokeStyles=[this.offscreenCtx.strokeStyle]),Array.isArray(a.offsets)&&a.offsets.length)for(let $=0;$<a.offsets.length;$++)a.offsets[$]={x:a.offsets[$]&&a.offsets[$].x||0,y:a.offsets[$]&&a.offsets[$].y||0};else a.offsets?a.offsets=[{x:a.offsets.x||0,y:a.offsets.y||0}]:a.offsets=[{x:0,y:0}];void 0!==a.colors&&console.warn('"colors" is not a valid option for drawStrings(). Use "fillStyles" or "strokeStyles" instead.');let w;"string"==typeof t&&(t=[t]),"string"==typeof e&&(e=[e]),t&&0!==t.length||(t=[this.offscreenCtx.font]),w=t.length;let b=e.length,v=0,S=0;for(let C=0;C<b;C++){this.offscreenCtx.save(),this.offscreenCtx.font=t[C%w],this.offscreenCtx.textAlign="left";let k=t[C%w].match(/[0-9]+px/,"");if(k=k?parseFloat(k[0]):10,a.offsets){let _=a.offsets[C%a.offsets.length];this.offscreenCtx.translate(_.x,_.y)}a.fill&&(this.offscreenCtx.fillStyle=a.fillStyles[C%a.fillStyles.length],this.offscreenCtx.fillText(e[C],i+v,s)),a.stroke&&(this.offscreenCtx.strokeStyle=a.strokeStyles[C%a.strokeStyles.length],this.offscreenCtx.strokeText(e[C],i+v,s)),v+=this.offscreenCtx.measureText(e[C]).width,S=Math.max(S,1.5*k),this.offscreenCtx.restore()}return new CMPoint(i+v,s+S)}measureStrings(t,e){"string"==typeof t?t=[t]:t&&0!==t.length||(t=[this.offscreenCtx.font]),"string"==typeof e&&(e=[e]);let i=t.length,s=e.length,n=0;this.offscreenCtx.save(),this.offscreenCtx.textAlign="left";for(let h=0;h<s;h++)this.offscreenCtx.font=t[h%i],n+=this.offscreenCtx.measureText(e[h]).width;return this.offscreenCtx.restore(),n}drawStringsCentered(t,e,i=this.center.x,s=this.center.y,n={}){let h={fill:!0,stroke:!1,fillStyles:[],strokeStyles:[],offsets:[],angle:0,centerVertically:!0},a={};for(let o in h)a[o]=void 0!==n[o]?n[o]:h[o];let r=t,l=0;"string"==typeof t&&(r=[t]),t&&0!==t.length||(r=[this.offscreenCtx.font]);let c=Array.isArray(e)?e:[e];if("string"==typeof a.fillStyles?a.fillStyles=[a.fillStyles]:a.fillStyles&&0!==a.fillStyles.length||(a.fillStyles=[this.offscreenCtx.fillStyle]),"string"==typeof a.strokeStyles?a.strokeStyles=[a.strokeStyles]:a.strokeStyles&&0!==a.strokeStyles.length||(a.strokeStyles=[this.offscreenCtx.strokeStyle]),Array.isArray(a.offsets)&&a.offsets.length)for(let d=0;d<a.offsets.length;d++)a.offsets[d]={x:a.offsets[d]&&a.offsets[d].x||0,y:a.offsets[d]&&a.offsets[d].y||0};else a.offsets?a.offsets=[{x:a.offsets.x||0,y:a.offsets.y||0}]:a.offsets=[{x:0,y:0}];l=r.length;let u=c.length,g=0;this.offscreenCtx.save(),this.offscreenCtx.textAlign="left",a.centerVertically&&(this.offscreenCtx.textBaseline="middle");let f=this.measureStrings(r,c),m=i-.5*f;0!==a.angle&&(this.offscreenCtx.translate(i,s),this.offscreenCtx.rotate(a.angle),this.offscreenCtx.translate(-i,-s));for(let p=0;p<u;p++){if(this.offscreenCtx.save(),this.offscreenCtx.font=r[p%l],a.offsets){let y=a.offsets[p%a.offsets.length];this.offscreenCtx.translate(y.x,y.y)}a.fill&&(this.offscreenCtx.fillStyle=a.fillStyles[p%a.fillStyles.length],this.offscreenCtx.fillText(c[p],m+g,s)),a.stroke&&(this.offscreenCtx.strokeStyle=a.strokeStyles[p%a.strokeStyles.length],this.offscreenCtx.strokeText(c[p],m+g,s)),g+=this.offscreenCtx.measureText(c[p]).width,this.offscreenCtx.restore()}return this.offscreenCtx.restore(),new CMPoint(i+.5*f*Math.cos(a.angle),s+.5*f*Math.sin(a.angle))}playSound(t){if(!this.soundOn)return;let e=this;CMSound.play(this.audioSources[t]).then(CMGame.noop,function(){try{e.audioMap.get(t).play()}catch(i){console.error(`Error playing sound ${t}.
					Check that all files are loaded.`)}})}stopSound(t){let e=this;CMSound.stop(this.audioSources[t]).then(CMGame.noop,()=>{try{e.audioMap.get(t).pause(),e.audioMap.get(t).currentTime=0}catch(i){console.error("Error pausing sound "+t)}})}pauseSound(t){let e=this;CMSound.stop(this.audioSources[t]).then(CMGame.noop,()=>{try{e.audioMap.get(t).pause()}catch(i){console.error("Error pausing sound "+t)}})}playMusic(t){if(!this.musicOn)return;let e=this;CMSound.loop(this.audioSources[t]).then(CMGame.noop,()=>{try{e.audioMap.get(t).loop=!0,e.audioMap.get(t).play()}catch(i){console.error(`Error playing sound ${t}.
					Check that all files are loaded.`)}})}pauseMusic(t){let e=this;CMSound.pause(this.audioSources[t]).then(CMGame.noop,()=>{try{e.audioMap.get(t).pause()}catch(i){console.error("Error pausing sound "+t)}})}stopMusic(t){let e=this;CMSound.stop(this.audioSources[t]).then(CMGame.noop,()=>{try{e.audioMap.get(t).pause(),e.audioMap.get(t).currentTime=0}catch(i){console.error("Error pausing sound "+t)}})}zoom(t,e=this.unzoomedOrigin){if("number"!=typeof t||t<=0||!Number.isFinite(t)||Number.isNaN(t))return console.error(`zoom() must take a positive integer
				or float value as its argument. Set to 1 for 100%.`),this;let i=this.zoomLevel;for(let s of(1===i&&(this.unzoomedTickDistance=this.tickDistance,this.unzoomedGridlineDistance=this.gridlineDistance,this.unzoomedOrigin.x=this.origin.x,this.unzoomedOrigin.y=this.origin.y,this.unzoomedGraphScalar=this.graphScalar),this.onbeforezoom(t,i),this.zoomLevel=t,this.tickDistance=this.unzoomedTickDistance/this.zoomLevel,this.gridlineDistance=this.unzoomedGridlineDistance/this.zoomLevel,this.origin.x=this.unzoomedOrigin.x,this.origin.y=this.unzoomedOrigin.y,this.functions))s.unzoomedStart=new CMPoint(s.start),s.unzoomedEnd=new CMPoint(s.end),s.origin.x=s.unzoomedOrigin.x=this.origin.x,s.origin.y=s.unzoomedOrigin.y=this.origin.y;for(let n of(this.graphScalar=this.unzoomedGraphScalar,this.functions))n.start.x=n.unzoomedStart.x,n.start.y=n.unzoomedStart.y,n.end.x=n.unzoomedEnd.x,n.end.y=n.unzoomedEnd.y,n.updateBounds(i);if(1===t)return this.onzoom(t,i),this;let h=(e.x-this.origin.x)/t,a=(e.y-this.origin.y)/t;for(let o of(this.origin.x=this.origin.x-h,this.origin.y=this.origin.y-a,this.functions))o.origin.x=o.unzoomedOrigin.x=this.origin.x,o.origin.y=o.unzoomedOrigin.y=this.origin.y;for(let r of(this.graphScalar/=t,this.functions))r.start.x=r.unzoomedStart.x,r.start.y=r.unzoomedStart.y,r.end.x=r.unzoomedEnd.x,r.end.y=r.unzoomedEnd.y,r.updateBounds(i);return this.onzoom(t,i),this.paused&&this.draw(),this}setFrameout(t,e){if(0===(e=Math.ceil(e)))return t.call(this,this.frameCount),this;if(e<0)return Number.isFinite(this.frameCap)?this.setFrameout(CMGame.mod(e,0,this.frameCap)):(console.error(`setFrameout() must take non-negative integer as second argument
					if game's frameCap property is not finite`),this);let i=(this.frameCount+e)%this.frameCap;if(this.frameoutFunctions.has(i)){let s=this.frameoutFunctions.get(i),n=function(e){s(e),t(e)};this.frameoutFunctions.set(i,n)}else this.frameoutFunctions.set(i,t);return this}toDegrees(t){return 180*t/Math.PI}toRadians(t){return Math.PI*t/180}toPolar(t,e){let i,s;if("number"==typeof e?(i=t,s=e):(i=t.x,s=t.y),0===i)return s>0?{r:s,theta:Math.PI/2}:s<0?{r:-s,theta:3*Math.PI/2}:{r:0,theta:0};let n=Math.atan(s/i);return i<0?n+=Math.PI:s<0&&(n+=2*Math.PI),{r:Math.hypot(i,s),theta:n}}fromPolar(t,e){return"number"==typeof e?{x:CMGame.roundSmall(t*Math.cos(e)),y:CMGame.roundSmall(t*Math.sin(e))}:{x:CMGame.roundSmall(t.r*Math.cos(t.theta)),y:CMGame.roundSmall(t.r*Math.sin(t.theta))}}slopeToDegrees(t,e){if(!Number.isFinite(t))switch(e){case"right":case 1:if(t===1/0)return 90;return 270;case"left":case 2:if(t===1/0)return 270;return 90;default:return[90,270]}let i=this.slopeToRadians(t,e);return Array.isArray(i)?[this.toDegrees(i[0]),this.toDegrees(i[1])]:this.toDegrees(i)}slopeToRadians(t,e=1){if(!Number.isFinite(t))switch(e){case"right":case 1:if(t===1/0)return .5*Math.PI;return 1.5*Math.PI;case"left":case 2:if(t===1/0)return 1.5*Math.PI;return .5*Math.PI;default:return[.5*Math.PI,1.5*Math.PI]}let i=this.toPolar({x:1,y:t}).theta;switch(e){case"right":case 1:return i;case"left":case -1:return CMGame.mod(i+Math.PI,0,Math.TAU);default:return[i,CMGame.mod(i+Math.PI,0,Math.TAU)].sort()}}degreesToSlope(t){return 90===(t=CMGame.mod(t,0,360))?1/0:270===t?-1/0:Math.tan(this.toPolar(t))}radiansToSlope(t){return(t=CMGame.mod(t,0,Math.TAU))===Math.PI/2?1/0:t===3*Math.PI/2?-1/0:Math.tan(t)}getSlope(t,e){return(e.y-t.y)/(e.x-t.x)}toBinary(t){return(t>>>0).toString(2)}fromBinary(t){return parseInt(t,2)}setNumberOfSets(t,e=0){this.numSets=t,this.vennSets.clear(),this.vennRegions.clear();let i=Math.floor(this.width/16);this.ctx.save(),this.ctx.font=`italic ${i}px Times New Roman, serif`;let s=0;switch(t){case 0:default:this.vennRegions.set("I",new CMVennRegion(this,"",0));break;case 1:this.vennRegions.set("I",new CMVennRegion(this,"0",0)),this.vennRegions.set("II",new CMVennRegion(this,"1",0)),s=.35*Math.min(this.width,this.height),this.vennSets.set("A",new CMVennSet(this,.5*this.width,.5*this.height,s,{text:"A",x:.5*this.width+.75*s,y:.5*this.height+s}));break;case 2:1===e?(this.vennRegions.set("I",new CMVennRegion(this,"0S0",1)),this.vennRegions.set("II",new CMVennRegion(this,"0S1",1)),this.vennRegions.set("III",new CMVennRegion(this,"1S1",1)),s=Math.round(this.height*(9/40)),this.vennSets.set("A",new CMVennSet(this,Math.round(.5*this.width),Math.round(.6*this.height),s,{text:"A",x:Math.round(.5*this.width+.65*s),y:Math.round(.6*this.height+.95*s)})),s=.4*this.height,this.vennSets.set("B",new CMVennSet(this,.5*this.width,.5*this.height,s,{text:"B",x:.5*this.width+.65*s,y:.5*this.height+.9*s}))):(this.vennRegions.set("I",new CMVennRegion(this,"00",0)),this.vennRegions.set("II",new CMVennRegion(this,"10",0)),this.vennRegions.set("III",new CMVennRegion(this,"01",0)),this.vennRegions.set("IV",new CMVennRegion(this,"11",0)),s=.35*Math.min(this.width,this.height),this.vennSets.set("A",new CMVennSet(this,.5*this.width-s/2.1,.5*this.height,s,{text:"A",x:.5*this.width-s/2.1-.75*s-this.ctx.measureText("A").width,y:.5*this.height+s})),this.vennSets.set("B",new CMVennSet(this,.5*this.width+s/2.1,.5*this.height,s,{text:"B",x:.5*this.width+s/2.1+.75*s,y:.5*this.height+s})));break;case 3:1===e?(this.vennRegions.set("I",new CMVennRegion(this,"0S0S0",1)),this.vennRegions.set("II",new CMVennRegion(this,"0S0S1",1)),this.vennRegions.set("III",new CMVennRegion(this,"0S1S1",1)),this.vennRegions.set("IV",new CMVennRegion(this,"1S1S1",1)),s=this.height/6,this.vennSets.set("A",new CMVennSet(this,.5*this.width,73/120*this.height,s,{text:"A",x:.5*this.width+.6*s,y:73/120*this.height+s})),s=.28125*this.height,this.vennSets.set("B",new CMVennSet(this,.5*this.width,67/120*this.height,s,{text:"B",x:.5*this.width+.8*s,y:67/120*this.height+.75*s})),s=.4*this.height,this.vennSets.set("C",new CMVennSet(this,.5*this.width,.5*this.height,s,{text:"C",x:.5*this.width+.9*s,y:.5*this.height+.55*s}))):2===e?(this.vennRegions.set("I",new CMVennRegion(this,"000",2)),this.vennRegions.set("II",new CMVennRegion(this,"100",2)),this.vennRegions.set("III",new CMVennRegion(this,"010",2)),this.vennRegions.set("IV",new CMVennRegion(this,"001",2)),this.vennRegions.set("V",new CMVennRegion(this,"110",2)),this.vennRegions.set("VI",new CMVennRegion(this,"101",2)),this.vennRegions.set("VII",new CMVennRegion(this,"011",2)),this.vennRegions.set("VIII",new CMVennRegion(this,"111",2)),s=.3*Math.min(this.width,this.height),this.vennSets.set("A",new CMVennSet(this,.4*this.width,.35*this.height,s,{text:"A",x:.4*this.width-.775*s-this.ctx.measureText("A").width,y:.35*this.height-.75*s})),this.vennSets.set("B",new CMVennSet(this,.8*Math.min(this.width,this.height),.35*this.height,s,{text:"B",x:.6*this.width+.775*s,y:.35*this.height-.75*s})),this.vennSets.set("C",new CMVennSet(this,.5*this.width,.625*this.height,s,{text:"C",x:.5*this.width+.6*s,y:.625*this.height+.9*s}))):(this.vennRegions.set("I",new CMVennRegion(this,"000",0)),this.vennRegions.set("II",new CMVennRegion(this,"100",0)),this.vennRegions.set("III",new CMVennRegion(this,"010",0)),this.vennRegions.set("IV",new CMVennRegion(this,"001",0)),this.vennRegions.set("V",new CMVennRegion(this,"110",0)),this.vennRegions.set("VI",new CMVennRegion(this,"101",0)),this.vennRegions.set("VII",new CMVennRegion(this,"011",0)),this.vennRegions.set("VIII",new CMVennRegion(this,"111",0)),s=.3*Math.min(this.width,this.height),this.vennSets.set("A",new CMVennSet(this,.4*this.width,.625*this.height,s,{text:"A",x:.4*this.width-.75*s-this.ctx.measureText("A").width,y:.625*this.height+s})),this.vennSets.set("B",new CMVennSet(this,.6*this.width,.625*this.height,s,{text:"B",x:.6*this.width+.75*s,y:.625*this.height+s})),this.vennSets.set("C",new CMVennSet(this,.5*this.width,.35*this.height,s,{text:"C",x:.5*this.width+.75*s,y:.35*this.height-.75*s})))}this.ctx.restore()}addVertex(t){return t&&!this.vertices.includes(t)&&this.vertices.push(t),this}addVertices(...t){let e=this,i=t;return 1===arguments.length&&Array.isArray(arguments[0])&&(i=arguments[0]),i.forEach(t=>e.addVertex(t)),this}removeVertex(t){return t&&this.vertices.includes(t)&&this.vertices.splice(this.vertices.indexOf(t),1),this}removeVertices(...t){let e=t;1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]);let i=e.length;for(;i--;)this.removeVertex(e[i]);return this}addEdge(t){return t&&!this.edges.includes(t)&&this.edges.push(t),this}addEdges(...t){let e=this,i=t;return 1===arguments.length&&Array.isArray(arguments[0])&&(i=arguments[0]),i.forEach(t=>e.addEdge(t)),this}removeEdge(t){return t&&this.edges.includes(t)&&this.edges.splice(this.edges.indexOf(t),1),this}removeEdges(...t){let e=t;1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]);let i=e.length;for(;i--;)this.removeEdge(e[i]);return this}almostEqual(t,e){return"object"==typeof t?new CMPoint(t).isAlmost(new CMPoint(e)):Math.abs(t-e)<1/this.graphScalar}getSprites(){return this.sprites}getFunctions(){return this.functions}getEdges(){return this.edges}getVertices(){return this.vertices}getVennRegions(){return Array.from(this.vennRegions.values())}getVennSets(){return Array.from(this.vennSets.values())}getDoodles(){return this.doodles}alert(t="",e={}){let i=this,s=this.paused;s||this.pause();let n=this.doodleOptions.enabled;if(n&&(this.doodleOptions.enabled=!1),this.alertMessage.innerHTML=t,this.alertCancelButton.style.display="none",this.alertInput.style.display="none",this.alertInput.addEventListener("blur",function(t){document.documentElement.scrollTop=CMGame.documentScrollTop},!1),this.alertElement.querySelector("h3").innerText=e.headerText||(document.title||"Game")+" says:",this.alertOKButton.innerHTML=e.buttonText||e.button1Text||"OK",e.draggable){let h=this.alertElement.offsetLeft,a=this.alertElement.offsetTop,o=!1;this.alertElement.onmousedown=this.alertElement.ontouchstart=function(t){o=!0,"touchstart"===t.type?(h=t.targetTouches[0].clientX,a=t.targetTouches[0].clientY):(h=t.clientX,a=t.clientY)},this.alertElement.onmouseup=this.alertElement.ontouchend=function(t){o=!1},this.alertElement.onmousemove=this.alertElement.ontouchmove=function(t){if(!o)return;let e=0,s=0;"touchmove"===t.type?(e=t.targetTouches[0].clientX,s=t.targetTouches[0].clientY):(e=t.clientX,s=t.clientY);let n=e-h,r=s-a;h=e,a=s,i.alertElement.style.left=parseInt(window.getComputedStyle(i.alertElement).getPropertyValue("left").replace("px",""))+n+"px",i.alertElement.style.top=parseInt(window.getComputedStyle(i.alertElement).getPropertyValue("top").replace("px",""))+r+"px"}}else this.alertElement.onmousedown=null,this.alertElement.onmouseup=null,this.alertElement.onmousemove=null,this.alertElement.ontouchstart=null,this.alertElement.ontouchend=null,this.alertElement.ontouchmove=null;return new Promise(function(t,e){i.alertOKButton.onclick=function(e){e.preventDefault(),i.alertOverlay.style.display="none",i.alertElement.style.left="",i.alertElement.style.top="",s||i.unpause(),n&&(i.doodleOptions.enabled=!0),t()},i.alertOKButton.focus(),i.alertOverlay.style.display="block"})}confirm(t="",e={}){let i=this,s=this.paused;s||this.pause();let n=this.doodleOptions.enabled;if(n&&(this.doodleOptions.enabled=!1),this.alertMessage.innerHTML=t,this.alertCancelButton.style.display="inline-block",this.alertInput.style.display="none",this.alertElement.querySelector("h3").innerText=e.headerText||(document.title||"Game")+" says:",this.alertOKButton.innerHTML=e.button1Text||"OK",this.alertCancelButton.innerHTML=e.button2Text||"Cancel",e.draggable){let h=this.alertElement.offsetLeft,a=this.alertElement.offsetTop,o=!1;this.alertElement.onmousedown=this.alertElement.ontouchstart=function(t){o=!0,"touchstart"===t.type?(h=t.targetTouches[0].clientX,a=t.targetTouches[0].clientY):(h=t.clientX,a=t.clientY)},this.alertElement.onmouseup=this.alertElement.ontouchend=function(t){o=!1},this.alertElement.onmousemove=this.alertElement.ontouchmove=function(t){if(!o)return;let e=0,s=0;"touchmove"===t.type?(e=t.targetTouches[0].clientX,s=t.targetTouches[0].clientY):(e=t.clientX,s=t.clientY);let n=e-h,r=s-a;h=e,a=s,i.alertElement.style.left=parseInt(window.getComputedStyle(i.alertElement).getPropertyValue("left").replace("px",""))+n+"px",i.alertElement.style.top=parseInt(window.getComputedStyle(i.alertElement).getPropertyValue("top").replace("px",""))+r+"px"}}else this.alertElement.onmousedown=null,this.alertElement.onmouseup=null,this.alertElement.onmousemove=null,this.alertElement.ontouchstart=null,this.alertElement.ontouchend=null,this.alertElement.ontouchmove=null;return new Promise(function(t,e){i.alertOKButton.onclick=function(e){e.preventDefault(),i.alertOverlay.style.display="none",i.alertElement.style.left="",i.alertElement.style.top="",s||i.unpause(),n&&(i.doodleOptions.enabled=!0),t(!0)},i.alertOKButton.focus(),i.alertCancelButton.onclick=function(e){e.preventDefault(),i.alertOverlay.style.display="none",i.alertElement.style.left="",i.alertElement.style.top="",s||i.unpause(),n&&(i.doodleOptions.enabled=!0),t(!1)},i.alertOverlay.style.display="block"})}prompt(t="",e="",i={}){let s=this,n=this.paused;n||this.pause();let h=this.doodleOptions.enabled;if(h&&(this.doodleOptions.enabled=!1),CMGame.documentScrollTop=document.documentElement.scrollTop||0,this.alertMessage.innerHTML=t,this.alertInput.placeholder=i.placeholder||"",this.alertInput.value=e,this.alertInput.style.display="inline-block",this.alertCancelButton.style.display="inline-block",this.alertElement.querySelector("h3").innerText=i.headerText||(document.title||"Game")+" says:",this.alertOKButton.innerHTML=i.button1Text||"OK",this.alertCancelButton.innerHTML=i.button2Text||"Cancel",i.draggable){let a=this.alertElement.offsetLeft,o=this.alertElement.offsetTop,r=!1;this.alertElement.onmousedown=this.alertElement.ontouchstart=function(t){r=!0,"touchstart"===t.type?(a=t.targetTouches[0].clientX,o=t.targetTouches[0].clientY):(a=t.clientX,o=t.clientY)},this.alertElement.onmouseup=this.alertElement.ontouchend=function(t){r=!1},this.alertElement.onmousemove=this.alertElement.ontouchmove=function(t){if(!r)return;let e=0,i=0;"touchmove"===t.type?(e=t.targetTouches[0].clientX,i=t.targetTouches[0].clientY):(e=t.clientX,i=t.clientY);let n=e-a,h=i-o;a=e,o=i,s.alertElement.style.left=parseInt(window.getComputedStyle(s.alertElement).getPropertyValue("left").replace("px",""))+n+"px",s.alertElement.style.top=parseInt(window.getComputedStyle(s.alertElement).getPropertyValue("top").replace("px",""))+h+"px"}}else this.alertElement.onmousedown=null,this.alertElement.onmouseup=null,this.alertElement.onmousemove=null,this.alertElement.ontouchstart=null,this.alertElement.ontouchend=null,this.alertElement.ontouchmove=null;return new Promise(function(t,e){s.alertOKButton.onclick=function(e){e.preventDefault(),s.alertOverlay.style.display="none",s.alertElement.style.left="",s.alertElement.style.top="",s.alertInput.placeholder="",n||s.unpause(),h&&(s.doodleOptions.enabled=!0),t(s.alertInput.value)},s.alertCancelButton.style.display="inline-block",s.alertCancelButton.onclick=function(e){e.preventDefault(),s.alertOverlay.style.display="none",s.alertElement.style.left="",s.alertElement.style.top="",s.alertInput.placeholder="",n||s.unpause(),h&&(s.doodleOptions.enabled=!0),t(null)},s.alertOverlay.style.display="block",s.alertInput.focus()})}enterFullscreen(t){let e=document.documentElement;if(e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),!t)return;let i;try{i=window.screen.orientation?this.orientationLock.call(window.screen.orientation,t||"landscape"):this.orientationLock.call(window.screen,t||"landscape")}catch(s){console.warn("Cannot lock orientation on this device")}}exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}}CMGame.clearAll=function(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)CMGame.clearAll(arguments[e]);return Array.from(arguments)}if(Array.isArray(t))t.splice(0,t.length);else if(t instanceof Map)t.clear();else for(let i in t)t.hasOwnProperty(i)&&delete t[i];return t},CMGame.pickFrom=t=>{if(Array.isArray(t))return t[CMRandom.range(0,t.length)];if(t instanceof Map){let e=[];for(let[i,s]of t)e.push(s);return e[CMRandom.range(0,e.length)]}{let n=Object.values(t);return n[CMRandom.range(0,n.length)]}},CMGame.pluckFrom=(t,e)=>{if(Array.isArray(t))return e?t.splice(t.indexOf(e),1)[0]:t.splice(CMRandom.range(0,t.length),1)[0];if(t instanceof Map){let i=-1,s=[];for(let[n,h]of t)s.push(h),h===e&&(i=n);if(e)return t.delete(i),e;let a=s[CMRandom.range(0,s.length)];return t.delete(a),t.get(a)}{let o=Object.entries(t),r=e?o.find(t=>t[1]===e)[0]:o[CMRandom.range(0,o.length)][0],l=t[r];return delete t[r],l}},CMGame.shuffle=t=>{let e=[];for(let i=0;i<t.length;i++)e.push(t[i]);for(t=CMGame.clearAll(t);e.length>0;)t.push(CMGame.pluckFrom(e));return t},CMGame.last=t=>{let e=Array.from(t);return e[e.length-1]},CMGame.isPrimitiveSubArray=(t,e)=>{let i="{(*&$(*(";return e.join(i).includes(t.join(i))},CMGame.noop=()=>{},CMGame.trimFilename=t=>{let e=t.substr(0,t.lastIndexOf("."));return e.substr(e.lastIndexOf("/")+1)},CMGame.running_Android=!!window.navigator.userAgent.match(/android/gi),CMGame.running_iOS=!!(/ipad|iphone|ipod/gi.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&"ontouchend"in document||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||window.navigator.platform.match(/ipad|iphone|ipod/gi))&&!window.MSStream,CMGame.documentScrollTop=document.documentElement.scrollTop||0,CMGame.running_iOS?(CMGame.screenWidth=window.screen.availWidth,CMGame.screenHeight=window.screen.availHeight,documentBody.clientWidth||(documentBody.clientWidth=CMGame.screenWidth,documentBody.clientHeight=CMGame.screenHeight)):window.screen&&window.screen.width?(CMGame.screenWidth=window.screen.width,CMGame.screenHeight=window.screen.height):window.outerWidth?(CMGame.screenWidth=window.outerWidth,CMGame.screenHeight=window.outerHeight):(CMGame.screenWidth=document.documentElement.clientWidth,CMGame.screenHeight=document.documentElement.clientHeight),CMGame.onpageload=CMGame.noop,CMGame.pageLoaded=!1,CMGame.onresourcesload=CMGame.noop,CMGame.resourcesLoaded=!1,CMGame.manageLoad=t=>{!CMGame.pageLoaded&&(document.querySelectorAll("body").length>1&&document.querySelectorAll("body").forEach(t=>{t!==document.body&&t.parentNode.removeChild(t)}),window.scrollTo(0,0),document.documentElement.scrollTop=0,document.documentElement.scrollLeft=0,CMGame.pageLoaded=!0,CMGame.onpageload.call(window,t),domLoaded=!0,initializeIfReady())},window.history.scrollRestoration="manual",document.documentElement.addEventListener("load",()=>{window.scrollTo(0,0),document.documentElement.scrollTop=0,document.documentElement.scrollLeft=0},!1),window.addEventListener("pageshow",CMGame.manageLoad,!1),window.addEventListener("load",CMGame.manageLoad,!1),document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&CMGame.manageLoad.call(window)},!1),CMGame.PIXELS_FOR_SWIPE=5,CMGame.SAVE_PREFIX="cmgamesave_",Object.defineProperty(CMGame,"MAX_FPS",{value:60,writable:!1}),Object.defineProperty(CMGame,"MIN_FRAME_DELAY",{value:15,writable:!1}),Object.defineProperty(CMGame.prototype,"fps",{get(){return this.fps_Private},set(t){this.fps_Private=Math.min(t,CMGame.MAX_FPS),this.frameDelay_Private!==1e3/this.fps_Private&&(this.frameDelay_Private=1e3/this.fps_Private)}}),Object.defineProperty(CMGame.prototype,"frameDelay",{get(){return this.frameDelay_Private},set(t){let e=this;this.frameDelay_Private=Math.max(t,CMGame.MIN_FRAME_DELAY),this.fps_Private!==Math.floor(1e3/this.frameDelay_Private)&&(this.fps_Private=Math.floor(1e3/this.frameDelay_Private)),window.requestNextFrame=function(i){e.awaitingAnimFrame=!0,setTimeout(function(){e.paused||(e.animFrameId=requestAnimationFrame(i)),e.awaitingAnimFrame=!1},t)}}});class CMColor{constructor(t=0,e=0,i=0,s=1){if("string"==typeof t){let n=t;if(n.startsWith("#"))8===(n=n.replace("#","")).length&&(n=n.substring(0,6),this.a=parseInt(n.substring(0,2),16)),3===n.length&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2],this.a=1),this.r=parseInt(n.substring(0,2),16),this.g=parseInt(n.substring(2,4),16),this.b=parseInt(n.substring(4,6),16),void 0===this.a&&(this.a=1);else if(n.startsWith("rgb")){let h=n.replace("rgba(","").replace("rgb(","").replace(")","").split(",");this.r=parseInt(h[0]),this.g=parseInt(h[1]),this.b=parseInt(h[2]),4===h.length?this.a=parseFloat(h[3]):this.a=1}}else"object"==typeof t?(this.r=t.r,this.g=t.g,this.b=t.b,this.a=void 0===t.a?1:t.a):(this.r=t,this.g=e,this.b=i,this.a=s)}brighten(t=10){return this.r=CMGame.clamp(this.r+t,0,255),this.g=CMGame.clamp(this.g+t,0,255),this.b=CMGame.clamp(this.b+t,0,255),this}darken(t=10){return this.r=CMGame.clamp(this.r-t,0,255),this.g=CMGame.clamp(this.g-t,0,255),this.b=CMGame.clamp(this.b-t,0,255),this}increaseOpacity(t=.1){return this.a=CMGame.clamp(this.a+t,0,1),this}decreaseOpacity(t=.1){return this.a=CMGame.clamp(this.a-t,0,1),this}}Object.defineProperty(CMColor.prototype,"value",{get(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}}),CMColor.FUSCHIA="rgb(253, 13, 136)",CMColor.MAGENTA="rgb(228, 0, 228)",CMColor.PINK="rgb(254, 3, 133)",CMColor.RED="rgb(250, 0, 92)",CMColor.DARK_RED="rgb(133, 33, 33)",CMColor.ORANGE="rgb(254, 137, 39)",CMColor.YELLOW="rgb(255, 245, 10)",CMColor.GOLD="rgb(255, 193, 4)",CMColor.LIGHT_GREEN="rgb(0, 240, 0)",CMColor.GREEN="rgb(0, 185, 0)",CMColor.DARK_GREEN="rgb(0, 136, 0)",CMColor.SKY_BLUE="rgb(142, 227, 252)",CMColor.LIGHT_BLUE="rgb(0, 250, 235)",CMColor.BLUE="rgb(1, 97, 251)",CMColor.DARK_BLUE="rgb(2, 8, 66)",CMColor.BLUE_GREEN="rgb(0, 168, 153)",CMColor.VIOLET="rgb(185, 51, 158)",CMColor.PURPLE="rgb(128, 0, 128)",CMColor.BROWN="rgb(121, 74, 25)",CMColor.SAND="rgb(242, 245, 235)",CMColor.TAN="rgb(242, 228, 205)",CMColor.PEACH="rgb(242, 222, 212)",CMColor.WHITE="rgb(255, 255, 255)",CMColor.ALMOST_WHITE="rgb(250, 250, 250)",CMColor.BLACK="rgb(5, 8, 11)",CMColor.ALMOST_BLACK="rgb(15, 23, 33)",CMColor.GRAY="rgb(158, 158, 158)",CMColor.LIGHT_GRAY="rgb(205, 205, 205)",CMColor.DARK_GRAY="rgb(58, 58, 58)",CMColor.TRANSLUCENT_WHITE="rgba(255, 255, 255, 0.85)",CMColor.TRANSLUCENT_BLACK="rgba(0, 0, 0, 0.85)",CMColor.NONE="rgba(0, 0, 0, 0)",Object.defineProperty(CMGame.prototype,"font",{get(){let t=this,e=this.offscreenCtx.font.match(/[0-9]+[A-Za-z]+/,"");return{rel:e=>e/t.screenScalar,MONO:`${e=e?e[0]:"10px"} monospace`,SANS_SERIF:`${e} OpenSans, Arial, sans-serif`,SERIF:`${e} Times New Roman, serif`,VARIABLE:`italic calc(${e} * 1.1) Times New Roman, serif`}}}),Object.defineProperty(CMGame.prototype,"graphScalar",{get(){return this.graphScalar_Private},set(t){let e=this.graphScalar_Private||120;for(let i of(this.graphScalar_Private=t,this.unzoomedGraphScalar=t*this.zoomLevel,this.functions))i.updateBounds(e),i.buildGraphPath(this.offscreenCtx),i.drawGraphPath(this.offscreenCtx)}}),CMGame.toastElement||(CMGame.toastElement=document.createElement("span"),CMGame.toastElement.setAttribute("id","cmToast"),CMGame.toastElement.classList.add("cm-toast"),documentBody.appendChild(CMGame.toastElement),CMGame.toastElement.addEventListener("animationend",function(){CMGame.toastElement.style.display="none"},!1),CMGame.toastElement.addEventListener("animationcancel",function(){CMGame.toastElement.style.display="none"},!1)),CMGame.offscreenToastElement||(CMGame.offscreenToastElement=document.createElement("span"),CMGame.offscreenToastElement.setAttribute("id","cmOffscreenToast"),CMGame.offscreenToastElement.classList.add("cm-toast"),CMGame.offscreenToastElement.style.display="inline-block",CMGame.offscreenToastElement.style.left="-100vw",CMGame.offscreenToastElement.style.top="-100vh",documentBody.appendChild(CMGame.offscreenToastElement)),CMGame.showToast=function(t,e=0,i="auto",s=CMGame.noop){CMGame.offscreenToastElement.innerHTML=t,CMGame.toastElement.innerHTML=t;let n;n="number"==typeof i?i/1e3:2+Math.ceil(.3*t.split(/\s|(<br>)|(<br\/>)/).length);let h=function(t){s.call(CMGame.toastElement,t),CMGame.toastElement.removeEventListener("animationend",h,!1)};CMGame.toastElement.addEventListener("animationend",h,!1);let a=CMGame.offscreenToastElement.getBoundingClientRect(),o=parseFloat(window.getComputedStyle(CMGame.offscreenToastElement).getPropertyValue("width").replace("px",""))||0,r=Math.max(a.right-a.left,o);CMGame.toastElement.style.opacity="0",CMGame.toastElement.style.display="none",CMGame.toastElement.style.left=`calc(50vw - ${.5*r}px)`,CMGame.toastElement.style.animationDuration=CMGame.toastElement.style.webkitAnimationDuration=`${n}s`,setTimeout(function(){CMGame.toastElement.style.display="inline-block"},e)},CMGame.showToasts=function(t,e=0){let i=e,s=4e3;for(let n=0;n<t.length;n++)s=2e3+1e3*Math.ceil(.3*t[n].split(/\s|(<br>)|(<br\/>)/).length),function(e,i){setTimeout(function(){CMGame.showToast(t[e])},i)}(n,i),i+=s+1e3};class CMSprite{constructor(t,e,i,s,n,h=null,a="none",o={}){this.game=t,this.x=e,this.y=i,this.z=o.z||0,this.boundingRule_Private=a,this.layer_Private=o.layer||0,this.layer=this.layer_Private,this.boundingRuleTop="none",this.boundingRuleRight="none",this.boundingRuleBottom="none",this.boundingRuleLeft="none",this.boundingRule=a,this.boundingRect=null,o.boundingRect?"number"==typeof o.boundingRect.x&&"number"==typeof o.boundingRect.y&&"number"==typeof o.boundingRect.width&&"number"==typeof o.boundingRect.height?this.boundingRect=o.boundingRect:console.warn(`CMSprite option
					'boundingRect' requires numerical
					 x, y, width, and height properties`):this.boundingRect={x:0,y:0,width:t.width,height:t.height},this.shape,this.width,this.height,this.radius,"circle"===n?(this.shape="circle",this.radius=s,this.width=2*this.radius,this.height=2*this.radius):"line"===n?(this.shape="line",this.width=s,this.height=s,this.radius=0,this.start={x:e,y:i},this.end={x:e+s,y:i}):(this.shape="rect",this.width=s,this.height=n,this.radius=Math.hypot(this.width,this.height)),this.pathFunction=null,this.pathFunctionOffset=null,this.pathFunctionFollow="end",this.image=null,this.fillStyle=CMColor.BLACK,this.strokeStyle=CMColor.NONE,"string"==typeof h||h instanceof CanvasGradient||h instanceof CanvasPattern?(this.fillStyle=h,this.strokeStyle=h):h instanceof CMImage||h instanceof HTMLImageElement?this.image=h:"function"==typeof h&&(this.draw=function(t){this.pathFunction instanceof CMFunction&&this.pathFunction.draw(t),h.call(this,t)}),this.velocity=new CMPoint,this.acceleration=new CMPoint,this.opacity=1,this.velocity.opacity=0,"function"==typeof o.onbeforeupdate?this.onbeforeupdate=o.onbeforeupdate:this.onbeforeupdate=CMGame.noop,"function"==typeof o.onupdate?this.onupdate=o.onupdate:this.onupdate=CMGame.noop,"function"==typeof o.onbeforedraw?this.onbeforedraw=o.onbeforedraw:this.onbeforedraw=CMGame.noop,"function"==typeof o.ondraw?this.ondraw=o.ondraw:this.ondraw=CMGame.noop,"function"==typeof o.onfadein&&(this.onfadein=o.onfadein),"function"==typeof o.onfadeout&&(this.onfadeout=o.onfadeout),this.ondestroy=null,"function"==typeof o.ondestroy&&(this.ondestroy=o.ondestroy),this.onscreen=!1,this.hasEnteredScreen=!1,this.x>this.game.width||this.y>this.game.height||this.x+this.width<0||this.y+this.height<0?this.onscreen=!1:(this.onscreen=!0,this.hasEnteredScreen=!0),this.hitbox=null,this.hurtbox=null;let r=this;!function(){let t=r;Object.defineProperty(r,"hitbox",{set(e){t=e},get(){switch(typeof t){case"function":return t.call(r);case"object":return t;default:return r}}})}(),function(){let t=r;Object.defineProperty(r,"hurtbox",{set(e){t=e},get(){switch(typeof t){case"function":return t.call(r);case"object":return t;default:return r}}})}()}destroy(){return this.game.removeSprite(this),this}setPath(t,e){if(t||0===t){if(t instanceof CMFunction){let i={follow:"end",offset:null};"string"==typeof e?i.follow=e:e&&(i.follow=e.follow||"end",e.offset&&(i.offset={x:e.offset.x||0,y:e.offset.y||0})),this.pathFunction=t,this.pathFunctionOffset=i.offset,this.pathFunctionFollow=i.follow,this.pathFunction.animationTime=0,this.pathFunction.velocity.animationTime=1}else if(Array.isArray(t))this.velocity.x=t[0],this.velocity.y=t[1],this.velocity.z=t[2]||0,this.pathFunction=null;else if("object"==typeof t){if("number"==typeof t.r||"number"==typeof t.theta){let s=game.fromPolar({r:t.r||1,theta:t.theta||this.game.slopeToRadians(this.velocity.y/this.velocity.x,Math.sign(this.velocity.x))});this.velocity.x=s.x,this.velocity.y=s.y}else this.velocity.x=t.x||0,this.velocity.y=t.y||0;this.velocity.z=t.z||0,this.pathFunction=null}else this.velocity.x=arguments[0]||0,this.velocity.y=arguments[1]||0,this.velocity.z=arguments[2]||0,this.pathFunction=null}else this.pathFunction=null}update(t){if(this.pathFunction instanceof CMFunction){switch(this.game.functions.includes(this.pathFunction)||this.pathFunction.update(t),this.pathFunction.type){case"xofy":this.y=this.game.yToScreen(this.pathFunction[this.pathFunctionFollow].y,this.pathFunction.origin),this.x=this.game.xToScreen(this.pathFunction.of(this.pathFunction[this.pathFunctionFollow].y),this.pathFunction.origin);break;case"polar":let e=this.game.fromPolar(this.pathFunction.of(this.pathFunction[this.pathFunctionFollow].theta),this.pathFunction[this.pathFunctionFollow].theta);this.x=this.game.xToScreen(e.x,this.pathFunction.origin),this.y=this.game.yToScreen(e.y,this.pathFunction.origin);break;case"parametric":let i=this.pathFunction.of(this.pathFunction[this.pathFunctionFollow].t);this.x=this.game.xToScreen(i.x,this.pathFunction.origin),this.y=this.game.yToScreen(i.y,this.pathFunction.origin);break;default:this.x=this.game.xToScreen(this.pathFunction[this.pathFunctionFollow].x,this.pathFunction.origin),this.y=this.game.yToScreen(this.pathFunction.of(this.pathFunction[this.pathFunctionFollow].x),this.pathFunction.origin)}this.pathFunctionOffset?(this.x+=this.pathFunctionOffset.x,this.y+=this.pathFunctionOffset.y):"circle"!==this.shape&&(this.x-=.5*this.width,this.y-=.5*this.height)}else this.velocity.x+=this.acceleration.x,this.velocity.y+=this.acceleration.y;switch(this.acceleration.z&&(this.velocity.z+=this.acceleration.z),this.x+=this.velocity.x,this.y+=this.velocity.y,this.velocity.z&&(this.z+=this.velocity.z),this.velocity.opacity&&(this.opacity+=this.velocity.opacity,this.velocity.opacity>0&&this.opacity>=1&&(this.opacity=1,this.velocity.opacity=0,this.onfadein(t)),this.velocity.opacity<0&&this.opacity<=0&&(this.opacity=0,this.velocity.opacity=0,this.onfadeout(t))),this.shape){case"line":this.boundAsLine();break;case"circle":this.boundAsCircle();break;case"rect":this.boundAsRect(this,this.boundingRect)}}fadeIn(t=500,e=!1){let i=this,s=e?t:this.game.fps*(t/1e3);return this.velocity.opacity=1/s,new Promise(function(t,e){i.game.setFrameout(t,s)})}fadeOut(t=500,e=!1){let i=this,s=e?t:this.game.fps*(t/1e3);return this.velocity.opacity=-1/s,new Promise(function(t,e){i.game.setFrameout(t,s)})}moveToward(t,e=1,i=this.center){let s=e;if("object"==typeof t&&t.x===i.x)return t.y===i.y?this.setPath(0,0):(s=e*Math.sign(t.y-i.y),this.setPath(0,s));let n=this.game,h=null;if("string"==typeof t)t.endsWith("rad")?h=parseFloat(t.replace(/(Math\.)?pi/ig,""+Math.PI).replace(/(Math\.)?tau/ig,""+Math.TAU)):t.endsWith("deg")?h=n.toRadians(parseFloat(t)):(h=0,console.error("CMSprite moveToward() requires 'rad' or 'deg' at the end of first string argument"));else{let a;i.x,t.x,a=n.getSlope(i,t),h=t.x-i.x==0?t.y>i.y?1.5*Math.PI:.5*Math.PI:n.slopeToRadians(a,Math.sign(t.x-i.x))}let o=n.fromPolar({r:1,theta:h});this.setPath(o.x*e,o.y*s)}boundAsLine(t=this.boundingRect){let e={x:Math.min(this.start.x,this.end.x),y:Math.min(this.start.y,this.end.y),width:Math.abs(this.end.x-this.start.x),height:Math.abs(this.end.y-this.start.y)};return this.boundAsRect(e,t)}boundAsCircle(t=this.boundingRect){if(this.hasEnteredScreen){if(this.x-this.radius<this.boundingRect.x)switch(this.boundingRuleLeft){case"wrap":if(this.x+this.radius<t.x)for(this.x=t.width+this.radius;this.x+this.radius<t.x;)this.x+=t.width;break;case"bounce":this.x=t.x+this.radius,this.velocity.x=Math.abs(this.velocity.x);break;case"fence":this.x=t.x+this.radius;break;case"destroy":this.x+this.radius<t.x&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleLeft&&this.boundingRuleLeft.call(this)}if(this.x+this.radius>t.x+t.width)switch(this.boundingRuleRight){case"wrap":if(this.x-this.radius>t.x+t.width)for(this.x=-this.radius+(this.x-this.radius-t.width);this.x-this.radius>t.x+t.width;)this.x-=t.width;break;case"bounce":this.x=t.x+t.width-this.radius,this.velocity.x=-Math.abs(this.velocity.x);break;case"fence":this.x=t.x+t.width-this.radius;break;case"destroy":this.x-this.radius>t.x+t.width&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleRight&&this.boundingRuleRight.call(this)}if(this.y-this.radius<t.y)switch(this.boundingRuleTop){case"wrap":if(this.y+this.radius<t.y)for(this.y=t.y+t.height+this.radius;this.y+this.radius<t.y;)this.y+=t.height;break;case"bounce":this.y=t.y+this.radius,this.velocity.y=Math.abs(this.velocity.y);break;case"fence":this.y=t.y+this.radius;break;case"destroy":this.y+this.radius<t.y&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleTop&&this.boundingRuleTop.call(this)}if(this.y+this.radius>t.y+t.height)switch(this.boundingRuleBottom){case"wrap":if(this.y-this.radius>t.y+t.height)for(this.y=-this.radius+(this.y-this.radius-t.height);this.y-this.radius>t.y+t.height;)this.y-=t.height;break;case"bounce":this.y=t.y+t.height-this.radius,this.velocity.y=-Math.abs(this.velocity.y);break;case"fence":this.y=t.y+t.height-this.radius;break;case"destroy":this.y-this.radius>t.y+t.height&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleBottom&&this.boundingRuleBottom.call(this)}}this.x-this.radius>this.game.width||this.y-this.radius>this.game.height||this.x+this.radius<0||this.y+this.radius<0?this.onscreen=!1:(this.hasEnteredScreen=!0,this.onscreen=!0)}boundAsRect(t=this,e=this.boundingRect){if(this.hasEnteredScreen){if(t.x<e.x)switch(this.boundingRuleLeft){case"wrap":if(t.x+t.width<e.x)for(this.x=e.width+(t.x+t.width);this.x+this.width<e.x;)this.x+=e.width;break;case"bounce":this.x=e.x,this.velocity.x=Math.abs(this.velocity.x);break;case"fence":this.x=e.x;break;case"destroy":t.x+t.width<e.x&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleLeft&&this.boundingRuleLeft.call(this,t)}if(t.x+t.width>e.x+e.width)switch(this.boundingRuleRight){case"wrap":if(t.x>e.x+e.width)for(this.x=t.x-e.width;this.x>e.x+e.width;)this.x-=e.width;break;case"bounce":this.x=e.x+e.width-t.width,this.velocity.x=-Math.abs(this.velocity.x);break;case"fence":this.x=e.x+e.width-t.width;break;case"destroy":t.x>e.x+e.width&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleRight&&this.boundingRuleRight.call(this,t)}if(t.y<e.y)switch(this.boundingRuleTop){case"wrap":if(t.y+t.height<e.y)for(this.y=e.height+(t.y+t.height);this.y+this.height<e.y;)this.y+=e.height;break;case"bounce":this.y=e.y,this.velocity.y=Math.abs(this.velocity.y);break;case"fence":this.y=e.y;break;case"destroy":t.y+t.height<e.y&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleTop&&this.boundingRuleTop.call(this,t)}if(t.y+t.height>e.y+e.height)switch(this.boundingRuleBottom){case"wrap":if(t.y>e.y+e.height)for(this.y=t.y-e.height;this.y>e.y+e.height;)this.y-=e.height;break;case"bounce":this.y=e.y+e.height-t.height,this.velocity.y=-Math.abs(this.velocity.y);break;case"fence":this.y=e.y+e.height-t.height;break;case"destroy":t.y>e.y+e.height&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleBottom&&this.boundingRuleBottom.call(this,t)}}this.x>this.game.width||this.y>this.game.height||this.x+this.width<0||this.y+this.height<0?this.onscreen=!1:(this.hasEnteredScreen=!0,this.onscreen=!0)}boundAsPolygon(t=this,e=this.boundingRect){if(this.hasEnteredScreen){if(t.x<=0)switch(this.boundingRuleLeft){case"wrap":if(t.x+t.width<=0){this.x+=this.game.width;for(let i=0,s=this.points.length;i<s;i++)this.points[i].x+=this.game.width;for(;this.x+this.width<0;){this.x+=this.game.width;for(let n=0,h=this.points.length;n<h;n++)this.points[n].x+=this.game.width}}break;case"bounce":this.x=0,this.velocity.x=Math.abs(this.velocity.x);break;case"fence":this.x=0;break;case"destroy":t.x+t.width<0&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleLeft&&this.boundingRuleLeft.call(this,t)}else if(t.x+t.width>=this.game.width)switch(this.boundingRuleRight){case"wrap":if(t.x>=this.game.width){this.x-=this.game.width;for(let a=0,o=this.points.length;a<o;a++)this.points[a].x-=this.game.width;for(;this.x>this.game.width;){this.x-=this.game.width;for(let r=0,l=this.points.length;r<l;r++)this.points[r].x-=this.game.width}}break;case"bounce":this.x=this.game.width-t.width,this.velocity.x=-Math.abs(this.velocity.x);break;case"fence":this.x=this.game.width-t.width;break;case"destroy":t.x>this.game.width&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleRight&&this.boundingRuleRight.call(this,t)}else if(t.y<=0)switch(this.boundingRuleTop){case"wrap":if(t.y+t.height<=0){this.y+=this.game.height;for(let c=0,d=this.points.length;c<d;c++)this.points[c].y+=this.game.height;for(;this.y+this.height<0;){this.y+=this.game.height;for(let u=0,g=this.points.length;u<g;u++)this.points[u].y+=this.game.height}}break;case"bounce":this.y=0,this.velocity.y=Math.abs(this.velocity.y);break;case"fence":this.y=0;break;case"destroy":t.y+t.height<0&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleTop&&this.boundingRuleTop.call(this,t)}else if(t.y+t.height>=this.game.height)switch(this.boundingRuleBottom){case"wrap":if(t.y>=this.game.height){this.y-=this.game.height;for(let f=0,m=this.points.length;f<m;f++)this.points[f].y-=this.game.height;for(;this.y>this.game.height;){this.y-=this.game.height;for(let p=0,y=this.points.length;p<y;p++)this.points[p].y-=this.game.height}}break;case"bounce":this.y=this.game.height-t.height,this.velocity.y=-Math.abs(this.velocity.y);break;case"fence":this.y=this.game.height-t.height;break;case"destroy":t.y>this.game.height&&this.destroy();break;case"none":break;default:"function"==typeof this.boundingRuleBottom&&this.boundingRuleBottom.call(this,t)}}this.x>this.game.width||this.y>this.game.height||this.x+this.width<0||this.y+this.height<0?this.onscreen=!1:(this.hasEnteredScreen=!0,this.onscreen=!0)}draw(t){if(this.pathFunction instanceof CMFunction&&!this.game.functions.includes(this.pathFunction)&&this.pathFunction.draw(t),this.image)"circle"===this.shape?t.drawImage(this.image,this.x-this.radius,this.y-this.radius,this.width,this.height):t.drawImage(this.image,this.x,this.y,this.width,this.height);else switch(this.shape){case"circle":t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.TAU,!1),t.fill(),t.stroke();break;case"line":t.lineWidth=this.width,t.strokeStyle=this.strokeStyle,this.game.drawLine(this.start,this.end);break;default:t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.fillRect(this.x,this.y,this.width,this.height),t.strokeRect(this.x,this.y,this.width,this.height)}}containsPoint(t,e){let i=null;switch(i="number"==typeof t?{x:t,y:e}:t,this.shape){case"circle":return this.game.distance(this,i)<=this.radius;case"line":return this.game.ctx.lineWidth=this.width,this.game.ctx.isPointInStroke(this.path,i.x,i.y);case"rect":return this.game.areColliding(this,{x:i.x,y:i.y,width:1,height:1});default:return this.game.ctx.lineWidth=this.width,this.game.ctx.isPointInPath(this.path,i.x,i.y)||this.game.ctx.isPointInStroke(this.path,i.x,i.y)}}onupdate(t){}onbeforedraw(t){}ondraw(t){}onfadein(t){}onfadeout(t){}}Object.defineProperties(CMSprite.prototype,{center:{get(){switch(this.shape){case"rect":return new CMPoint(this.x+.5*this.width,this.y+.5*this.height);case"line":return CMGame.midpoint(this.start,this.end);case"circle":return new CMPoint(this.x,this.y);default:return new CMPoint(this.left+.5*this.width,this.top+.5*this.height)}},set(t){switch(this.shape){case"rect":this.x=t.x-.5*this.width,this.y=t.y-.5*this.height;break;case"line":let e=this.game.getSlope(this.start,this.end);if(Number.isFinite(e)){let i=(this.end.x-this.start.x)/2;this.end.x=t.x+i,this.end.y=t.y+e*i,this.start.x=t.x-i,this.start.y=t.y-e*i}else{let s=(this.end.y-this.start.y)/2;this.end.x=t.y+e*s,this.end.y=t.y+s,this.start.x=t.x-e*s,this.start.y=t.y-s}break;case"circle":this.x=t.x,this.y=t.y;break;default:this.left=t.x-.5*this.width,this.top=t.y-.5*this.height}}},bottom:{set(t){"circle"===this.shape?this.y=t-this.radius:this.y=t-this.height},get(){return"circle"===this.shape?this.y+this.radius:this.y+this.height}},right:{set(t){"circle"===this.shape?this.x=t-this.radius:this.x=t-this.width},get(){return"circle"===this.shape?this.x+this.radius:this.x+this.width}},left:{set(t){"circle"===this.shape?this.x=t+this.radius:this.x=t},get(){return"circle"===this.shape?this.x-this.radius:this.x}},top:{set(t){"circle"===this.shape?this.y=t-this.radius:this.y=t},get(){return"circle"===this.shape?this.y-this.radius:this.y}}}),Object.defineProperty(CMSprite.prototype,"boundingRule",{get(){return this.boundingRule_Private},set(t="none"){if(this.boundingRule_Private=t,Array.isArray(t))switch(t.length){case 1:[this.boundingRuleTop,this.boundingRuleRight,this.boundingRuleBottom,this.boundingRuleLeft]=[,,,,].fill(t[0]);break;case 2:this.boundingRuleTop=t[0],this.boundingRuleBottom=t[0],this.boundingRuleLeft=t[1],this.boundingRuleRight=t[1];break;case 4:[this.boundingRuleTop,this.boundingRuleRight,this.boundingRuleBottom,this.boundingRuleLeft]=t;break;default:console.error("Invalid array length of "+t.length+" for CMSprite bounding rule")}else[this.boundingRuleTop,this.boundingRuleRight,this.boundingRuleBottom,this.boundingRuleLeft]=[,,,,].fill(t)}}),Object.defineProperty(CMSprite.prototype,"layer",{get(){return this.layer_Private},set(t){"top"===t?t=game.sprites.reduce((t,e)=>Math.max(t,e.layer),0)+1:"bottom"===t&&(t=game.sprites.reduce((t,e)=>Math.min(t,e.layer),1/0)-1),this.layer_Private=t,this.game.sprites.sort((t,e)=>t.layer-e.layer)}}),CMGame.roundSmall=t=>{let e=t,i=1e-8,s="00000000000000",n="99999999999999";if((t+"").includes(".")){let h=(e=t+"").split("."),a=h[0],o=h[1];if(o.includes(s)&&(o=""+parseFloat(o.substring(0,o.indexOf(s)))),o.includes(n)){let r=o.indexOf(n);0===r?(a=parseInt(a)+Math.sign(t),o=0):(o=parseFloat("."+o.substring(0,r)),o+=1/10**r,o=parseFloat((o+"").replace(".","")))}e=parseFloat(a+"."+o)}return Math.abs(e)<i?0:e},CMGame.factorial=t=>{let e=1;for(let i=1;i<=t;i++)e*=i;return e},CMGame.P=(t,e)=>CMGame.factorial(t)/CMGame.factorial(t-e),CMGame.C=(t,e)=>CMGame.factorial(t)/(CMGame.factorial(e)*CMGame.factorial(t-e)),CMGame.sum=function(t,e=0,i=0){if("function"!=typeof t)return function(...t){return t.reduce((t,e)=>t+e)}(...arguments);let s=0,n=t(e),h=s+n,a=Math.abs(h-s);if(Number.isFinite(i))for(let o=e;o<=i;o++)s+=t(o);else try{for(let r=e,l=0;r<=i;r++,l++){if(s+=n,n=t(r+1),h=s+n,(a=Math.abs(h-s))<1e-12)return h;if(l>1e7)return}}catch(c){return}return s},CMGame.mean=(...t)=>CMGame.sum(...t)/t.length,CMGame.midpoint=(...t)=>{let e=t.reduce((t,e)=>t+e.x,0)/t.length,i=t.reduce((t,e)=>t+e.y,0)/t.length;return new CMPoint(e,i)},CMGame.clamp=(t,e,i)=>"number"==typeof i?Math.min(Math.max(e,t),i):Math.min(Math.max(0,t),e),CMGame.mod=(t,e,i)=>{let s=0;"number"==typeof i&&(s=e);let n=i-s;if(t>=0&&s>=0&&i>=0)return s+t%n;for(;t<s;)t+=n;for(;t>=i;)t-=n;return t};class CMFunction{constructor(t,e,i={}){let s=this;if(this.game=t,this.type=i.type||"cartesian",this.lineWidth=i.lineWidth||1,this.continuous=i.continuous||!0,i.discontinuousAt)Array.isArray(i.discontinuousAt)?this.discontinuousAt=function(t,e){return i.discontinuousAt.includes(t)}:"function"==typeof i.discontinuousAt&&(this.discontinuousAt=i.discontinuousAt);else{let n=e.toString();(n.includes("Math.floor")||n.includes("Math.ceil"))&&(this.continuous=!1,this.discontinuousAt=function(t,e){return!s.game.almostEqual(s.realToScreenOf(t),s.realToScreenOf(e))})}for(let h in this.origin=null,Array.isArray(i.origin)?this.origin=new CMPoint(i.origin[0],i.origin[1],0):"object"==typeof i.origin?this.origin=new CMPoint(i.origin.x,i.origin.y,0):this.origin=new CMPoint(t.origin),this.of=e,this.realToScreenOf=null,this.tStep="number"==typeof i.tStep?i.tStep:.1,this.thetaStep="number"==typeof i.thetaStep?i.thetaStep:Math.TAU/360,this.strokeStyle=i.strokeStyle||CMColor.DARK_GRAY,this.fillStyleBelow=i.fillStyleBelow,this.fillStyleAbove=i.fillStyleAbove,this.name=i.name||"",void 0!==i.color&&console.warn('"color" is not a valid option for CMFunction. Use "strokeStyle" instead.'),this.animationTime=0,this.start={t:0,x:-(this.origin.x/this.game.graphScalar),y:-((this.game.height-this.origin.y)/this.game.graphScalar),r:0,theta:0},i.start||(i.start={}),i.start)this.start[h]=i.start[h];for(let a in this.end={t:Math.max(this.game.width,this.game.height)/this.tStep,x:(this.game.width-this.origin.x)/this.game.graphScalar,y:this.origin.y/this.game.graphScalar,r:0,theta:Math.TAU},i.end||(i.end={}),i.end)this.end[a]=i.end[a];for(let o in this.velocity={animationTime:0,start:{t:0,x:0,y:0,r:0,theta:0},end:{t:0,x:0,y:0,r:0,theta:0}},i.velocity||(i.velocity={}),i.velocity)if("start"===o||"end"===o)for(let r in i.velocity[o])this.velocity[o][r]=i.velocity[o][r];else this.velocity[o]=i.velocity[o];if("function"==typeof i.onupdate&&(this.onupdate=i.onupdate),"function"==typeof i.onbeforedraw&&(this.onbeforedraw=i.onbeforedraw),"function"==typeof i.ondraw&&(this.ondraw=i.ondraw),this.path=new Path2D,this.pathAbove=null,this.pathBelow=null,this.valsArray=null,this.screenValsArray=null,this.fixed=!!i.fixed,this.fixed)switch(s.type){case"xofy":s.valsArray=Array((s.game.height-0)/1).fill(0).map((t,e,i)=>e).map(t=>s.of(s.game.xToReal(t,s.origin))),s.of=function(t){return s.valsArray[Math.floor(s.game.yToScreen(t))]},s.realToScreenOf=function(t){return s.game.xToScreen(s.of(t),s.origin)},s.screenValsArray=Array((s.game.height-0)/1).fill(0).map((t,e,i)=>e).map(t=>s.realToScreenOf(s.game.xToReal(t,s.origin))),s.realToScreenOf=function(t){return s.screenValsArray[Math.floor(s.game.yToScreen(t))]};break;case"polar":s.valsArray=Array(Math.floor((Math.TAU-0)/s.thetaStep)).fill(0).map((t,e,i)=>e).map(t=>s.of(t*s.thetaStep)),s.of=function(t){for(;t<0;)t+=Math.TAU;for(;t>Math.TAU;)t-=Math.TAU;return s.valsArray[Math.floor(t/s.thetaStep)]},s.realToScreenOf=function(t){return s.of(t)*s.game.graphScalar},s.screenValsArray=Array(Math.floor((Math.TAU-0)/s.thetaStep)).fill(0).map((t,e,i)=>e).map(t=>s.realToScreenOf(t*s.thetaStep)),s.realToScreenOf=function(t){return s.screenValsArray[Math.floor(t/s.thetaStep)]};break;case"parametric":s.valsArray=Array(Math.floor((s.end.t-s.start.t)/s.tStep)).fill(0).map((t,e,i)=>e).map(t=>s.of(t*s.tStep)),s.of=function(t){return s.valsArray[Math.floor(t)]},s.realToScreenOf=function(t){let e=s.of(t);return s.game.toScreen(e,s.origin)},s.screenValsArray=Array(Math.floor((s.end.t-s.start.t)/s.tStep)).fill(0).map((t,e,i)=>e).map(t=>s.realToScreenOf(t*s.tStep)),s.realToScreenOf=function(t){return s.screenValsArray[Math.floor(t)]};break;default:s.valsArray=Array((s.game.width-0)/1).fill(0).map((t,e,i)=>e).map(t=>s.of(s.game.xToReal(t,s.origin))),s.of=function(t){return s.valsArray[Math.floor(s.game.xToScreen(t))]},s.realToScreenOf=function(t){return s.game.yToScreen(s.of(t),s.origin)},s.screenValsArray=Array((s.game.width-0)/1).fill(0).map((t,e,i)=>e).map(t=>s.realToScreenOf(s.game.xToReal(t,s.origin))),s.realToScreenOf=function(t){return s.screenValsArray[Math.floor(s.game.xToScreen(t))]}}else switch(this.type){case"xofy":s.realToScreenOf=function(t){return s.game.xToScreen(s.of(t),s.origin)};break;case"polar":s.realToScreenOf=function(t){return s.of(t)*s.game.graphScalar};break;case"parametric":s.realToScreenOf=function(t){let e=s.of(t);return s.game.toScreen(e,s.origin)};break;default:s.realToScreenOf=function(t){return s.game.yToScreen(s.of(t),s.origin)}}this.unzoomedOrigin=new CMPoint(this.origin.x,this.origin.y),this.unzoomedStart=new CMPoint(this.start),this.unzoomedEnd=new CMPoint(this.end),this.buildGraphPath(this.game.offscreenCtx),this.fixed&&(this.draw=this.drawGraphPath)}updateBounds(t=1){this.origin.x=this.origin.x+(this.unzoomedOrigin.x-this.origin.x)/this.game.zoomLevel,this.origin.y=this.origin.y+(this.unzoomedOrigin.y-this.origin.y)/this.game.zoomLevel,this.origin.x-t*this.start.x==0&&(this.start.x=-(this.origin.x/this.game.graphScalar)),this.origin.x+t*this.end.x===this.game.canvas.width&&(this.end.x=(this.game.width-this.origin.x)/this.game.graphScalar),this.origin.y-t*this.start.y==0&&(this.start.y=-((this.game.height-this.origin.y)/this.game.graphScalar)),this.origin.y-t*this.end.y===this.game.canvas.height&&(this.end.y=this.origin.y/this.game.graphScalar)}buildGraphPath(t=this.game.offscreenCtx){let e=this.game,i=e.canvas,s,n,h,a,o;switch(this.path=new Path2D,this.type){case"cartesian":h=((s=Math.max(0,this.game.xToScreen(this.start.x,this.origin)))-this.origin.x)/e.graphScalar,n=Math.min(i.width,this.game.xToScreen(this.end.x,this.origin)),this.path.moveTo(s,this.realToScreenOf(h));for(let r=s+1;r<=n;r++){let l=(r-this.origin.x)/e.graphScalar,c=(r-1-this.origin.x)/e.graphScalar;0>this.realToScreenOf(l)&&this.realToScreenOf(c)>i.height||0>this.realToScreenOf(c)&&this.realToScreenOf(l)>i.height||this.discontinuousAt(c,l)?(this.continuous=!1,this.path.moveTo(r,this.realToScreenOf(l))):this.path.lineTo(r,this.realToScreenOf(l))}this.pathBelow=new Path2D(this.path),this.pathBelow.lineTo(n,i.height+t.lineWidth),this.pathBelow.lineTo(i.width,i.height+t.lineWidth),this.pathBelow.lineTo(s,i.height+t.lineWidth),this.pathBelow.closePath(),this.pathAbove=new Path2D(this.path),this.pathAbove.lineTo(n,0-t.lineWidth),this.pathAbove.lineTo(s,0-t.lineWidth),this.pathAbove.closePath();break;case"xofy":a=((s=Math.max(0,e.height-this.game.yToScreen(this.start.y,this.origin)))-this.origin.y)/e.graphScalar,n=Math.min(e.height,e.height-this.game.yToScreen(this.end.y,this.origin)),this.path.moveTo(this.realToScreenOf(a),e.height-s);for(let d=s+1;d<=n;d++){let u=-(e.height-d-this.origin.y)/e.graphScalar,g=-(this.origin.y-(d-1))/e.graphScalar;0>this.realToScreenOf(u)&&this.realToScreenOf(g)>i.width||0>this.realToScreenOf(g)&&this.realToScreenOf(u)>i.width?(this.continuous=!1,this.path.moveTo(this.realToScreenOf(u),e.height-d)):this.path.lineTo(this.realToScreenOf(u),e.height-d)}this.pathBelow=new Path2D(this.path),this.pathBelow.lineTo(-t.lineWidth,e.height-n),this.pathBelow.lineTo(-t.lineWidth,e.height-s),this.pathBelow.closePath(),this.pathAbove=new Path2D(this.path),this.pathAbove.lineTo(i.width+t.lineWidth,e.height-n),this.pathAbove.lineTo(i.width+t.lineWidth,e.height-s),this.pathAbove.closePath();break;case"polar":o=e.fromPolar({r:this.realToScreenOf(0),theta:0}),this.path.moveTo(this.origin.x+o.x,this.origin.y-o.y);for(let f=this.thetaStep;f<=Math.TAU;f+=this.thetaStep){let m=e.fromPolar({r:this.realToScreenOf(f),theta:f});this.path.lineTo(this.origin.x+m.x,this.origin.y-m.y)}this.pathBelow=new Path2D(this.path),this.pathBelow.closePath(),this.pathAbove=new Path2D(this.path),this.pathAbove.moveTo(e.width+t.lineWidth,this.origin.y-o.y),this.pathAbove.lineTo(e.width+t.lineWidth,e.height+t.lineWidth),this.pathAbove.lineTo(0-t.lineWidth,e.height+t.lineWidth),this.pathAbove.lineTo(0-t.lineWidth,0-t.lineWidth),this.pathAbove.lineTo(e.width+t.lineWidth,0-t.lineWidth),this.pathAbove.lineTo(e.width+t.lineWidth,this.origin.y-o.y);break;case"parametric":o=this.realToScreenOf(0),this.path.moveTo(o.x,o.y);for(let p=this.tStep;p<this.end.t;p+=this.tStep){let y=this.realToScreenOf(p);this.path.lineTo(y.x,y.y)}this.pathAbove=new Path2D(this.path),this.pathBelow=new Path2D(this.path)}}drawGraphPath(t=this.game.offscreenCtx){t.lineWidth=this.lineWidth,this.pathBelow&&this.fillStyleBelow&&this.fillStyleBelow!==CMColor.NONE&&(t.fillStyle=this.fillStyleBelow,t.fill(this.pathBelow)),this.pathAbove&&this.fillStyleAbove&&this.fillStyleAbove!==CMColor.NONE&&(t.fillStyle=this.fillStyleAbove,t.fill(this.pathAbove)),this.strokeStyle!==CMColor.NONE&&(t.strokeStyle=this.strokeStyle,t.stroke(this.path))}update(t){for(let e in this.velocity)if("start"===e||"end"===e)for(let i in this.velocity[e])this[e][i]+=this.velocity[e][i];else this[e]+=this.velocity[e];this.onupdate(t)}draw(t){switch(this.type){case"cartesian":return this.drawCartesian(t);case"polar":return this.drawPolar(t);case"parametric":return this.drawParametric(t);case"xofy":return this.drawXOfY(t)}}drawPolar(t){let e=this.game;e.canvas,t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle;let i=e.fromPolar({r:this.realToScreenOf(0),theta:0});this.path=new Path2D,this.path.moveTo(this.origin.x+i.x,this.origin.y-i.y);for(let s=this.thetaStep;s<=this.end.theta;s+=this.thetaStep){let n=e.fromPolar({r:this.realToScreenOf(s),theta:s});this.path.lineTo(this.origin.x+n.x,this.origin.y-n.y)}this.fillStyleBelow&&this.fillStyleBelow!==CMColor.NONE&&(this.pathBelow=new Path2D(this.path),this.pathBelow.closePath(),t.fillStyle=this.fillStyleBelow,t.fill(this.pathBelow)),this.fillStyleAbove&&this.fillStyleAbove!==CMColor.NONE&&(this.pathAbove=new Path2D(this.path),this.pathAbove.moveTo(e.width+t.lineWidth,this.origin.y-i.y),this.pathAbove.lineTo(e.width+t.lineWidth,e.height+t.lineWidth),this.pathAbove.lineTo(0-t.lineWidth,e.height+t.lineWidth),this.pathAbove.lineTo(0-t.lineWidth,0-t.lineWidth),this.pathAbove.lineTo(e.width+t.lineWidth,0-t.lineWidth),this.pathAbove.lineTo(e.width+t.lineWidth,this.origin.y-i.y),t.fillStyle=this.fillStyleAbove,t.fill(this.pathAbove)),t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,t.stroke(this.path)}drawParametric(t){this.game.canvas;let e=this.realToScreenOf(0);this.path=new Path2D,this.path.moveTo(e.x,e.y);for(let i=this.tStep;i<this.end.t;i+=this.tStep){let s=this.realToScreenOf(i);this.path.lineTo(s.x,s.y)}t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,t.stroke(this.path)}drawXOfY(t){let e=this.game,i=e.canvas,s=Math.max(0,e.height-this.game.yToScreen(this.start.y,this.origin)),n=(s-this.origin.y)/e.graphScalar,h=Math.min(e.height,e.height-this.game.yToScreen(this.end.y,this.origin));t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,this.path=new Path2D,this.path.moveTo(this.realToScreenOf(n),e.height-s);for(let a=s+1;a<=h;a++){let o=-(e.height-a-this.origin.y)/e.graphScalar,r=-(this.origin.y-(a-1))/e.graphScalar;0>this.realToScreenOf(o)&&this.realToScreenOf(r)>i.width||0>this.realToScreenOf(r)&&this.realToScreenOf(o)>i.width?(t.stroke(this.path),this.continuous=!1,this.path.moveTo(this.realToScreenOf(o),e.height-a)):this.path.lineTo(this.realToScreenOf(o),e.height-a)}this.fillStyleBelow&&this.fillStyleBelow!==CMColor.NONE&&(this.pathBelow=new Path2D(this.path),this.pathBelow.lineTo(-t.lineWidth,e.height-h),this.pathBelow.lineTo(-t.lineWidth,e.height-s),this.pathBelow.closePath(),t.fillStyle=this.fillStyleBelow,t.fill(this.pathBelow)),this.fillStyleAbove&&this.fillStyleAbove!==CMColor.NONE&&(this.pathAbove=new Path2D(this.path),this.pathAbove.lineTo(i.width+t.lineWidth,e.height-h),this.pathAbove.lineTo(i.width+t.lineWidth,e.height-s),this.pathAbove.closePath(),t.fillStyle=this.fillStyleAbove,t.fill(this.pathAbove)),t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,t.stroke(this.path)}drawCartesian(t){let e=this.game,i=e.canvas,s=Math.max(0,this.game.xToScreen(this.start.x,this.origin)),n=(s-this.origin.x)/e.graphScalar,h=Math.min(i.width,this.game.xToScreen(this.end.x,this.origin));t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,this.path=new Path2D,this.path.moveTo(s,this.realToScreenOf(n));for(let a=s+1;a<=h;a++){let o=(a-this.origin.x)/e.graphScalar,r=(a-1-this.origin.x)/e.graphScalar;0>this.realToScreenOf(o)&&this.realToScreenOf(r)>i.height||0>this.realToScreenOf(r)&&this.realToScreenOf(o)>i.height||this.discontinuousAt(r,o)?(t.stroke(this.path),this.continuous=!1,this.path=new Path2D,this.path.moveTo(a,this.realToScreenOf(o))):this.path.lineTo(a,this.realToScreenOf(o))}this.fillStyleBelow&&this.fillStyleBelow!==CMColor.NONE&&(this.pathBelow=new Path2D(this.path),this.pathBelow.lineTo(h,i.height+t.lineWidth),this.pathBelow.lineTo(s,i.height+t.lineWidth),this.pathBelow.closePath(),t.fillStyle=this.fillStyleBelow,t.fill(this.pathBelow)),this.fillStyleAbove&&this.fillStyleAbove!==CMColor.NONE&&(this.pathAbove=new Path2D(this.path),this.pathAbove.lineTo(h,0-t.lineWidth),this.pathAbove.lineTo(s,0-t.lineWidth),this.pathAbove.closePath(),t.fillStyle=this.fillStyleAbove,t.fill(this.pathAbove)),t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,t.stroke(this.path)}positionOf(t,e){let i={};if("number"==typeof t?(i.x=t,i.y=e):i=t,this.continuous){let s=this.game.ctx;if(s.isPointInStroke(this.path,i.x,i.y))return"on";if(s.isPointInPath(this.pathAbove,i.x,i.y))return"above";{if(s.isPointInPath(this.pathBelow,i.x,i.y))return"below";let n="color: rgb(225, 225, 0)",h="color: rgb(225, 225, 0)";return(i.x<0||i.x>this.game.width)&&(n="color: rgb(255, 95, 95)"),(i.y<0||i.y>this.game.height)&&(h="color: rgb(255, 95, 95)"),this.debug&&console.log(`Point (%c${i.x}%c, %c${i.y}%c) is outside canvas`,n,"color: default",h,"color: default"),"unknown"}}{let a=this.of(this.game.xToReal(i.x,this.origin)),o=this.game.yToReal(i.y,this.origin);return o===a?"on":o>a?"above":o<a?"below":"uknown"}}discontinuousAt(t,e){return!1}screenOf(t){let e;switch(this.type){case"cartesian":e=this.game.xToReal(t,this.origin);break;case"xofy":e=this.game.yToReal(t,this.origin);break;case"polar":case"parametric":e=t}return this.realToScreenOf(e)}screenToRealOf(t){let e;switch(this.type){case"cartesian":e=this.game.xToReal(t,this.origin);break;case"xofy":e=this.game.yToReal(t,this.origin);break;case"polar":case"parametric":e=t}return this.of(e)}clone(t={}){return t.operation="clone",this.operation("self",t)}plus(t,e={}){return e.operation="plus",this.operation(t,e)}minus(t,e={}){return e.operation="minus",this.operation(t,e)}times(t,e={}){return e.operation="times",this.operation(t,e)}dividedBy(t,e={}){return e.operation="dividedBy",this.operation(t,e)}composedWith(t,e={}){return e.operation="composedWith",this.operation(t,e)}operation(t,e={}){let i=this,s={},n=["type","strokeStyle","fillStyleBelow","fillStyleAbove","lineWidth","name","fixed","start","end","velocity","tStep","thetaStep","origin","onupdate","onbeforedraw","ondraw","discontinuousAt"];for(let h=0;h<n.length;h++)s[n[h]]=e[n[h]]||this[n[h]];let a=null;switch(e.operation){case"plus":a=function(e){return i.of(e)+t.of(e)};break;case"minus":a=function(e){return i.of(e)-t.of(e)};break;case"times":a=function(e){return i.of(e)*t.of(e)};break;case"dividedBy":a=function(e){return i.of(e)/t.of(e)};break;case"composedWith":a=function(e){return i.of(t.of(e))};break;default:a=function(t){return i.of(t)}}return new CMFunction(this.game,a,s)}onupdate(t){}onbeforedraw(t){}ondraw(t){}}class CMVennRegion extends CMSprite{constructor(t,e,i=0){super(t,0,0,0,"circle",null,"none",!0),this.regionCode=e,this.variation=i,this.filled=!1,this.fillStyle="red",this.path=new Path2D,this.label={text:"",x:0,y:0,active:!1,fillStyle:CMColor.BLACK};let s=Math.floor(this.game.width/16);switch(this.game.ctx.font=`italic ${s}px Times New Roman, serif`,this.regionCode){case"":this.label.text="I",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("I").width,this.label.y=.5*this.game.height;break;case"0":this.label.text="I",this.label.x=.15*this.game.width-.5*this.game.ctx.measureText("I").width,this.label.y=.25*this.game.height;break;case"1":this.label.text="II",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("I").width,this.label.y=.5*this.game.height;break;case"00":case"0S0":case"0S0S0":case"000":this.label.text="I",this.label.x=.15*this.game.width-.5*this.game.ctx.measureText("I").width,this.label.y=.2*this.game.height;break;case"10":this.label.text="II",this.label.x=.25*this.game.width-.5*this.game.ctx.measureText("II").width,this.label.y=.5*this.game.height;break;case"01":this.label.text="III",this.label.x=.75*this.game.width-.5*this.game.ctx.measureText("III").width,this.label.y=.5*this.game.height;break;case"0S1":this.label.text="II",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("II").width,this.label.y=.25*this.game.height;break;case"11":this.label.text="IV",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("IV").width,this.label.y=.5*this.game.height;break;case"1S1":this.label.text="III",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("III").width,this.label.y=.6*this.game.height;break;case"0S0S1":this.label.text="II",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("II").width,this.label.y=95;break;case"0S1S1":this.label.text="III",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("III").width,this.label.y=182;break;case"1S1S1":this.label.text="IV",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("IV").width,this.label.y=292;break;case"100":this.label.text="II",this.label.x=.25*this.game.width-.5*this.game.ctx.measureText("II").width,this.label.y=.7*this.game.height;break;case"010":this.label.text="III",this.label.x=.75*this.game.width-.5*this.game.ctx.measureText("III").width,this.label.y=.7*this.game.height;break;case"001":this.label.text="IV",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("IV").width,this.label.y=.2*this.game.height;break;case"110":this.label.text="V",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("V").width,this.label.y=.775*this.game.height;break;case"101":this.label.text="VI",this.label.x=.35*this.game.width-.5*this.game.ctx.measureText("VI").width,this.label.y=.45*this.game.height;break;case"011":this.label.text="VII",this.label.x=.65*this.game.width-.5*this.game.ctx.measureText("VII").width,this.label.y=.45*this.game.height;break;case"111":this.label.text="VIII",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("VIII").width,this.label.y=.525*this.game.height}if(2===i)switch(this.regionCode){case"000":this.label.text="I",this.label.x=.075*this.game.width-.5*this.game.ctx.measureText("I").width,this.label.y=.2*this.game.height;break;case"100":this.label.text="II",this.label.x=.2875*this.game.width-.5*this.game.ctx.measureText("II").width,this.label.y=.25*this.game.height;break;case"010":this.label.text="III",this.label.x=.7125*this.game.width-.5*this.game.ctx.measureText("III").width,this.label.y=.25*this.game.height;break;case"001":this.label.text="IV",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("IV").width,this.label.y=.7875*this.game.height;break;case"110":this.label.text="V",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("V").width,this.label.y=.225*this.game.height;break;case"101":this.label.text="VI",this.label.x=.35*this.game.width-.5*this.game.ctx.measureText("VI").width,this.label.y=.55*this.game.height;break;case"011":this.label.text="VII",this.label.x=.65*this.game.width-.5*this.game.ctx.measureText("VII").width,this.label.y=.55*this.game.height;break;case"111":this.label.text="VIII",this.label.x=.5*this.game.width-.5*this.game.ctx.measureText("VIII").width,this.label.y=.47*this.game.height}}containsPoint(t,e){let i=null;i="number"==typeof t?{x:t,y:e}:t;let s,n,h;switch(this.regionCode){case"":return!0;case"0":return!(s=this.game.vennSets.get("A")).containsPoint(t,e);case"1":return(s=this.game.vennSets.get("A")).containsPoint(t,e);case"00":case"0S0":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),!(s.containsPoint(t,e)||n.containsPoint(t,e));case"10":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),s.containsPoint(t,e)&&!n.containsPoint(t,e);case"01":case"0S1":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),!s.containsPoint(t,e)&&n.containsPoint(t,e);case"11":case"1S1":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),s.containsPoint(t,e)&&n.containsPoint(t,e);case"000":case"0S0S0":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),h=this.game.vennSets.get("C"),!(s.containsPoint(t,e)||n.containsPoint(t,e)||h.containsPoint(t,e));case"100":case"100":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),h=this.game.vennSets.get("C"),s.containsPoint(t,e)&&!n.containsPoint(t,e)&&!h.containsPoint(t,e);case"010":case"010":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),h=this.game.vennSets.get("C"),!s.containsPoint(t,e)&&n.containsPoint(t,e)&&!h.containsPoint(t,e);case"001":case"0S0S1":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),h=this.game.vennSets.get("C"),!s.containsPoint(t,e)&&!n.containsPoint(t,e)&&h.containsPoint(t,e);case"110":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),h=this.game.vennSets.get("C"),s.containsPoint(t,e)&&n.containsPoint(t,e)&&!h.containsPoint(t,e);case"101":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),h=this.game.vennSets.get("C"),s.containsPoint(t,e)&&!n.containsPoint(t,e)&&h.containsPoint(t,e);case"011":case"0S1S1":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),h=this.game.vennSets.get("C"),!s.containsPoint(t,e)&&n.containsPoint(t,e)&&h.containsPoint(t,e);case"111":case"1S1S1":return s=this.game.vennSets.get("A"),n=this.game.vennSets.get("B"),h=this.game.vennSets.get("C"),s.containsPoint(t,e)&&n.containsPoint(t,e)&&h.containsPoint(t,e)}}draw(t){if(this.filled){let e,i,s,n,h,a,o,r,l;switch(t.save(),t.fillStyle=this.fillStyle,this.regionCode){case"":t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"0":(e=this.game.vennSets.get("A")).drawComplement(t);break;case"1":case"1S1":case"1S1S1":e=this.game.vennSets.get("A"),t.fill(e.getPath(t));break;case"10":e=this.game.vennSets.get("A"),r=(i=this.game.vennSets.get("B")).getComplementPath(t),t.clip(r),t.beginPath(),t.arc(e.x,e.y,e.radius,0,Math.TAU,!1),t.fill();break;case"01":case"0S1":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),o=e.getComplementPath(t),t.clip(o),t.beginPath(),t.arc(i.x,i.y,i.radius,0,Math.TAU,!1),t.fill();break;case"11":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),t.beginPath(),t.arc(e.x,e.y,e.radius,0,Math.TAU,!1),t.clip(),t.beginPath(),t.arc(i.x,i.y,i.radius,0,Math.TAU,!1),t.clip(),t.fill();break;case"00":case"0S0":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),o=e.getComplementPath(t),r=i.getComplementPath(t),t.clip(o),t.clip(r),t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"0S0S0":(s=this.game.vennSets.get("C")).drawComplement(t);break;case"000":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),o=e.getComplementPath(t),r=i.getComplementPath(t),l=s.getComplementPath(t),t.clip(o),t.clip(r),t.clip(l),t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"100":case"100":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),n=e.getPath(t),r=i.getComplementPath(t),l=s.getComplementPath(t),t.clip(n),t.clip(r),t.clip(l),t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"010":case"010":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),o=e.getComplementPath(t),h=i.getPath(t),l=s.getComplementPath(t),t.clip(o),t.clip(h),t.clip(l),t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"001":case"0S0S1":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),o=e.getComplementPath(t),r=i.getComplementPath(t),a=s.getPath(t),t.clip(o),t.clip(r),t.clip(a),t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"110":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),n=e.getPath(t),h=i.getPath(t),l=s.getComplementPath(t),t.clip(n),t.clip(h),t.clip(l),t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"101":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),n=e.getPath(t),r=i.getComplementPath(t),a=s.getPath(t),t.clip(n),t.clip(r),t.clip(a),t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"011":case"0S1S1":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),o=e.getComplementPath(t),h=i.getPath(t),a=s.getPath(t),t.clip(o),t.clip(h),t.clip(a),t.fillRect(0,0,this.game.canvas.width,this.game.canvas.height);break;case"111":e=this.game.vennSets.get("A"),i=this.game.vennSets.get("B"),s=this.game.vennSets.get("C"),t.beginPath(),t.arc(e.x,e.y,e.radius,0,Math.TAU,!1),t.clip(),t.beginPath(),t.arc(i.x,i.y,i.radius,0,Math.TAU,!1),t.clip(),t.beginPath(),t.arc(s.x,s.y,s.radius,0,Math.TAU,!1),t.fill()}t.restore()}if(this.label.active){t.save();let c=Math.floor(this.game.width/16);t.font=`italic ${c}px Times New Roman, serif`,t.textBaseline="middle",t.fillStyle=this.label.fillStyle,t.fillText(this.label.text,this.label.x,this.label.y),t.restore()}}}class CMVennSet extends CMSprite{constructor(t,e,i,s,n){super(t,e,i,s,"circle",null,"none",{layer:1}),this.path=null,this.complementPath=null,this.strokeStyle=CMColor.BLACK,this.lineWidth=2,this.label={text:"",x:e+.75*s,y:i+s,active:!1,fillStyle:CMColor.BLACK},n&&(this.label.active=!0,this.label.x=n.x||this.label.x,this.label.y=n.y||this.label.y,this.label.text=n.text||this.label.text)}containsPoint(t,e){let i=null;return i="number"==typeof t?{x:t,y:e}:t,this.game.distance(this,i)<=this.radius}draw(t){if(t.save(),t.strokeStyle=this.strokeStyle,this.lineWidth>0&&(t.lineWidth=this.lineWidth,this.game.strokeOval(this.x,this.y,this.radius)),this.label.active){let e=Math.floor(this.game.width/16);t.font=`italic ${e}px Times New Roman, serif`,t.textBaseline="middle",t.fillStyle=this.label.fillStyle,t.fillText(this.label.text,this.label.x,this.label.y)}t.restore()}drawComplement(t){t.fill(this.getComplementPath(t))}getPath(t,e=!1){return this.path&&!e||(this.path=new Path2D,this.path.arc(this.x,this.y,this.radius,0,Math.TAU,!1)),this.path}getComplementPath(t,e=!1){return this.complementPath&&!e||(this.complementPath=new Path2D,this.complementPath.moveTo(0,0),this.complementPath.lineTo(this.game.canvas.width,0),this.complementPath.lineTo(this.game.canvas.width,this.game.canvas.height),this.complementPath.lineTo(0,this.game.canvas.height),this.complementPath.lineTo(0,this.y),this.complementPath.lineTo(this.x-this.radius,this.y),this.complementPath.arc(this.x,this.y,this.radius,0,Math.TAU,!0),this.complementPath.lineTo(0,this.y),this.complementPath.closePath()),this.complementPath}}class CMVertex extends CMSprite{constructor(t,e=0,i=0,s=10,n=CMColor.BLACK,h){if(super(t,e,i,s,"circle",n,"none",{layer:1}),this.degree=0,this.adjacentVertices=[],this.incidentEdges=[],this.label={text:"",x:e+20,y:i+20,active:!1,fillStyle:this.fillStyle,font:Math.max(12,.5*s)+"px Times New Roman, serif"},h){for(let a in h)this.label[a]=h[a];h.text&&void 0===h.active&&(this.label.active=!0)}}update(t){for(let e of(super.update(t),this.incidentEdges))this===e.vertex1?(e.start.x=this.x,e.start.y=this.y):this===e.vertex2&&(e.end.x=this.x,e.end.y=this.y)}adjacentTo(t){return this.adjacentVertices.includes(t)}incidentTo(t){return this.incidentEdges.includes(t)}draw(t){super.draw(t),this.label.active&&(t.fillStyle=this.label.fillStyle,t.font=this.label.font,t.fillText(this.label.text,this.label.x,this.label.y))}}class CMEdge extends CMSprite{constructor(t,e=null,i=null,s=1,n=CMColor.BLACK,h={},a=!1,o){if(super(t,0,0,s,"line",n,"none"),this.vertex1=e,this.vertex2=i,this.directed=a,this.weight=o,this.incidentVertices=[],this.incidentEdges=[],this.length=0,this.start={x:0,y:0},this.end={x:0,y:0},this.vertex1){for(let r of(this.vertex1.incidentEdges.push(this),this.vertex1.incidentEdges))this.incidentEdges.includes(r)||r===this||this.incidentEdges.push(r);this.start={x:this.vertex1.x,y:this.vertex1.y},this.x=this.start.x,this.y=this.start.y}if(this.vertex2){for(let l of(this.vertex2.incidentEdges.push(this),this.vertex2.incidentEdges))this.incidentEdges.includes(l)||l===this||this.incidentEdges.push(l);this.end={x:this.vertex2.x,y:this.vertex2.y}}else this.end={x:this.start.x,y:this.start.y};if(this.length=this.game.distance(this.start,this.end),this.path=new Path2D,this.arrowPath=new Path2D,this.rebuildPath(),this.vertex1&&this.vertex2&&(!this.vertex1.adjacentVertices.includes(this.vertex2)&&(this.vertex1.adjacentVertices.push(this.vertex2),this.vertex1.degree++),!this.vertex2.adjacentVertices.includes(this.vertex1)&&(this.vertex2.adjacentVertices.push(this.vertex1),this.vertex2.degree++)),this.label={text:"",x:0,y:0,active:!1,fillStyle:this.fillStyle,font:Math.max(5*s,16)+"px Times New Roman, serif"},h){for(let c in h)this.label[c]=h[c];h.text&&void 0===h.active&&(this.label.active=!0)}}changeDirection(){let t=this.game.vertices.indexOf(this.vertex1),e=this.game.vertices.indexOf(this.vertex2);this.vertex1=this.game.vertices[e],this.vertex2=this.game.vertices[t],this.vertex1&&(this.start={x:this.vertex1.x,y:this.vertex1.y},this.x=this.start.x,this.y=this.start.y),this.vertex2?this.end={x:this.vertex2.x,y:this.vertex2.y}:this.end={x:this.start.x,y:this.start.y},this.rebuildPath()}rebuildPath(){this.path=new Path2D,this.path.moveTo(this.start.x,this.start.y);let t=null,e=0,i=0,s=0,n=0;if(this.directed){for(t={x:this.end.x,y:this.end.y},Array.isArray(e=this.game.slopeToRadians(this.game.getSlope(this.start,this.end),Math.sign(this.end.x-this.start.x)))&&(e=e[0]);e>=Math.TAU;)e-=Math.TAU;for(i=e+Math.PI;i>=Math.TAU;)i-=Math.TAU;n=Math.SQRT1_2*(s=Math.max(1.5*this.width,8)),this.vertex2&&(t.x=this.end.x+(this.vertex2.radius+n)*Math.cos(i),t.y=this.end.y+(this.vertex2.radius+n)*Math.sin(i)),this.path.lineTo(t.x,t.y)}else this.path.lineTo(this.end.x,this.end.y);if(this.arrowPath=new Path2D,this.directed){let h=e-3*Math.PI/4,a=e+3*Math.PI/4;for(;h<0;)h+=Math.TAU;for(;a>Math.TAU;)a-=Math.TAU;this.vertex2.radius&&(t.x=this.end.x+this.vertex2.radius*Math.cos(i),t.y=this.end.y+this.vertex2.radius*Math.sin(i)),this.arrowPath.lineTo(t.x,t.y),this.arrowPath.lineTo(t.x+s*Math.cos(h),t.y+s*Math.sin(h)),this.arrowPath.lineTo(t.x+s*Math.cos(a),t.y+s*Math.sin(a)),this.vertex2&&this.vertex2.radius?this.arrowPath.lineTo(t.x,t.y):this.arrowPath.lineTo(this.end.x,this.end.y)}}update(t){super.update(t),this.rebuildPath()}draw(t){t.save(),t.lineWidth=this.width,t.strokeStyle=this.fillStyle,t.stroke(this.path),t.restore(),t.fillStyle=this.fillStyle,t.fill(this.arrowPath),this.label.active&&(t.fillStyle=this.label.fillStyle,t.font=this.label.font,t.fillText(this.label.text,this.label.x,this.label.y))}}class CMnGon extends CMSprite{constructor(t,e=3,i={}){let s={x:null,y:null,radius:null,rotation:0,fillStyle:CMColor.BLACK,strokeStyle:CMColor.NONE,lineWidth:1};for(let n in s)0===i[n]?s[n]=i[n]:s[n]=i[n]||s[n];null===s.x&&(s.x=t.center.x),null===s.y&&(s.y=t.center.y),null===s.radius&&(s.radius=t.graphScalar),super(t,s.x,s.y,s.radius,"circle",function(t){t.lineWidth=this.lineWidth,this.fillStyle!==CMColor.NONE&&(t.fillStyle=this.fillStyle,t.fill(this.path)),this.strokeStyle!==CMColor.NONE&&(t.strokeStyle=this.strokeStyle,t.stroke(this.path))}),this.fillStyle=s.fillStyle,this.strokeStyle=s.strokeStyle,this.lineWidth=s.lineWidth,this.n=e,this.rotation=s.rotation,this.points=[],this.rebuildPath(),this.previousState=[this.n,this.x,this.y,this.radius,this.rotation].join(";")}rebuildPath(){this.path=new Path2D,this.points=[];let t=Math.TAU/this.n,e=this.x+this.radius*Math.cos(this.rotation),i=this.y+this.radius*Math.sin(this.rotation);this.path.moveTo(e,i),this.points.push(new CMPoint(e,i));let s=1;for(let n=this.rotation+t;n<=this.rotation+Math.TAU+t&&this.points.length<=this.n;n+=t)e=this.x+this.radius*Math.cos(n),i=this.y+this.radius*Math.sin(n),this.path.lineTo(e,i),n<this.rotation+Math.TAU-.5*t&&(this.points.push(new CMPoint(e,i)),s++);this.path.closePath()}update(t){super.update(t),[this.n,this.x,this.y,this.radius,this.rotation].join(";")!==this.previousState&&(this.rebuildPath(),this.previousState=[this.n,this.x,this.y,this.radius,this.rotation].join(";")),this.boundAsCircle(),[this.n,this.x,this.y,this.radius,this.rotation].join(";")!==this.previousState&&(this.rebuildPath(),this.previousState=[this.n,this.x,this.y,this.radius,this.rotation].join(";"))}containsPoint(t,e){let i=null;return i="number"==typeof t?{x:t,y:e}:t,this.game.ctx.isPointInStroke(this.path,i.x,i.y)||this.game.ctx.isPointInPath(this.path,i.x,i.y)}}class CMPolygon extends CMSprite{constructor(t,e,i={}){let s=e.reduce((t,e)=>Math.min(t,e.x),t.width),n=e.reduce((t,e)=>Math.min(t,e.y),t.height),h=e.reduce((t,e)=>Math.max(t,e.x),0),a=e.reduce((t,e)=>Math.max(t,e.y),0),o=h-s,r=a-n;super(t,s,n,o,r,function(t){t.lineWidth=this.lineWidth,this.fillStyle!==CMColor.NONE&&(t.fillStyle=this.fillStyle,t.fill(this.path)),this.strokeStyle!==CMColor.NONE&&(t.strokeStyle=this.strokeStyle,t.stroke(this.path))});let l=this;this.x=this.left=s,this.y=this.top=n,this.oldX=this.newX=this.x,this.oldY=this.newY=this.y,this.right=h,this.bottom=a,this.width=o,this.height=r,"boolean"==typeof i.closed?this.closed=i.closed:this.closed=!0;let c={fillStyle:CMColor.NONE,strokeStyle:CMColor.GREEN,lineWidth:1};for(let d in c)c[d]=i[d]||c[d];this.game=t,this.points=e,this.numPoints=e.length,this.pointsRelativeToCenter=this.points.map(t=>({x:t.x-l.center.x,y:t.y-l.center.y})),this.polarPointsRelativeToCenter=this.pointsRelativeToCenter.map(t=>l.game.toPolar(t));let u=0;Object.defineProperty(this,"rotation",{get:()=>u,set(t){let e=t-u;u=CMGame.mod(t,0,Math.TAU),this.polarPointsRelativeToCenter=this.polarPointsRelativeToCenter.map(t=>({r:t.r,theta:CMGame.mod(t.theta+e,0,Math.TAU)})),this.pointsRelativeToCenter=this.polarPointsRelativeToCenter.map(t=>l.game.fromPolar(t)),this.points=this.pointsRelativeToCenter.map(t=>({x:l.center.x+t.x,y:l.center.y+t.y})),this.rebuildPath()}}),this.fillStyle=c.fillStyle,this.strokeStyle=c.strokeStyle,this.lineWidth=c.lineWidth,this.shape="polygon",this.path=new Path2D,this.rebuildPath()}update(t){if(super.update(t),0!==this.velocity.x||0!==this.velocity.y){for(let e=0,i=this.points.length;e<i;e++)this.points[e].x+=this.velocity.x,this.points[e].y+=this.velocity.y;this.left=this.points.reduce((t,e)=>Math.min(t,e.x),game.width),this.top=this.points.reduce((t,e)=>Math.min(t,e.y),game.height),this.right=this.points.reduce((t,e)=>Math.max(t,e.x),0),this.bottom=this.points.reduce((t,e)=>Math.max(t,e.y),0),this.rebuildPath()}this.boundAsPolygon(),this.rebuildPath()}rebuildPath(){this.path=new Path2D,this.path.moveTo(this.points[0].x,this.points[0].y);for(let t=1,e=this.points.length;t<e;t++)this.path.lineTo(this.points[t].x,this.points[t].y);this.closed&&this.path.closePath()}containsPoint(t,e){let i={};return i="number"==typeof t?{x:t,y:e}:t,this.game.ctx.lineWidth=this.lineWidth,this.closed&&this.game.ctx.isPointInPath(this.path,i.x,i.y)||this.game.ctx.isPointInStroke(this.path,i.x,i.y)}}Object.defineProperty(CMPolygon.prototype,"center",{get(){if(this.points.length)return CMGame.midpoint(...this.points)}}),Object.defineProperty(window,"cmboilerplate",{set(){console.log(`You cannot define cmboilerplate yourself. It is used internally to provide starting HTML code. If you are trying to get the cmboilerplate code, just type

	cmboilerplate
		
and press Enter`)},get(){let t=`<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name='viewport' content='width=device-width, initial-scale=1.0,
    maximum-scale=1.0, user-scalable=0, minimal-ui' />
  <title>
    <!-- Replace this line with your title -->
  </title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <link type="text/css" rel="stylesheet" href="css/cmgame.css" />
</head>
<body class="cm-dark_gray">
<div id="cmLoading" class="cm-almost_black">
  <h1 class="cm-text-white">Loading...</h1>
  <progress id="cmLoadingProgress" title="Loaded resources"
     value="0" max="0" class="cm-small-shadow-almost_white">
  </progress>
    <p>
      <span class="cm-text-white">Powered by CMGame Engine</span>
      <br/>
      <a href="https://github.com/tlong314/cmgame" class="cm-text-white">
	    github.com/tlong314/cmgame
	  </a>
    </p>
  </div>

  <article id="cmTitle" class="cm-white">
    <h1>
      <!-- Replace this line with your game's title -->
    </h1>
    <p>
      <!-- Replace this line with a description of your game. -->
    </p>
    <p class="cm-center-text">
      <label for="playBtn">
        <button id="playBtn" title="Click to play" class="cm-play-button">
          <div class="cm-play"></div>
        </button>
        <br/>
        Play now
      </label>
    </p>
  </article>
  <div id="cmWrapper" class="cm-none">
    <canvas id="cmCanvas" width="360" height="480" class="cm-sky_blue">
      Nothing to see here...
    </canvas>
  </div>
<script src="js/cmgame.js"></script>
<script>

// Your own JavaScript code will go here

</script>
</body>
</html>`;document.write(`OK. Copy all of the text in the box below. Then paste it into a text file
			and save it with the extension .html (for instance, name it <strong>myfile.html</strong> ).
			Then double-click on that file (myfile.html) in that folder to open the page in your browser.
			<textarea style='width: 100%; height: 100%'>${t}</textarea>`)}});